!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(r=r||self).IsoImage=e()}(this,function(){"use strict";Object.assign||(Object.assign=function(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var o,n=Object(r),i=Object.prototype.hasOwnProperty,a=0,s=e.length;a<s;a++)for(var u in o=Object(e[a]))i.call(o,u)&&(n[u]=o[u]);return n});var r=Math.max,e=Math.min,t=Math.abs,o=Math.floor;function n(r){return r=Number(r),isNaN(r)?0:0===r||r===1/0||r===-1/0?r:(r<0?-1:1)*o(t(r))}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var r,e;for(r=0,e=0;r<this.length;r++)e+=this[r];return e/this.length},Array.prototype.fill=function(t){var o=arguments[1],i=arguments[2],a=function(r){if(null==r)throw TypeError();return Object(r)}(this),s=function(r){var t=n(r);return t<=0?0:t===1/0?9007199254740991:e(t,9007199254740991)}(a.length);s=r(s,0);var u,l,f,c=n(o);for(u=c<0?r(s+c,0):e(c,s),f=(l=void 0===i?s:n(i))<0?r(s+l,0):e(l,s);u<f;){a[String(u)]=t,u+=1}return a},Array.prototype.rep=function(r){return Array.apply(null,new Array(r)).map(Number.prototype.valueOf,this[0])},Array.prototype.pip=function(r,e){var t,o,n=!1;for(t=0,o=this.length-1;t<this.length;o=t++)this[t][1]>e!=this[o][1]>e&&r<(this[o][0]-this[t][0])*(e-this[t][1])/(this[o][1]-this[t][1])+this[t][0]&&(n=!n);return n},function(r){var e={};function t(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return r[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}t.m=r,t.c=e,t.p="",t(0)}([function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=a(t(10)),n=a(t(5)),i=a(t(15));function a(r){return r&&r.__esModule?r:{default:r}}window&&(window.turfPointGrid=o.default,window.turfIsolines=n.default,window.turfBezierSpline=i.default,window.turfLineString=function(r,e,t){if(void 0===t&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");return feature({type:"LineString",coordinates:r},e,t)}),e.default=o.default},,,,,function(r,e,t){var o,n=(o=t(6))&&"object"==typeof o&&"default"in o?o.default:o,i=t(7),a=t(9),s=t(8),u={successCallback:null,verbose:!1},l={};function f(r,e,t){t=t||{};for(var o=Object.keys(u),n=0;n<o.length;n++){var i=o[n],a=t[i];a=null!=a?a:u[i],l[i]=a}l.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var s=function(r){var e=[],t=0;r.rows,r.cols;return r.cells.forEach(function(o,n){o.forEach(function(o,i){if(void 0!==o&&5!==(d=o).cval&&10!==d.cval&&!h(o)){var a=function(r,e,t){var o,n,i,a=r.length,s=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],l=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],f=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],c=(r[e][t],r[e][t]),h=c.cval,d=g(c,i=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][h]);s.push([t+d[0],e+d[1]]),d=g(c,i=f[h]),s.push([t+d[0],e+d[1]]),p(c);for(var v=t+u[h],y=e+l[h],w=h;v>=0&&y>=0&&y<a&&(v!=t||y!=e)&&void 0!==(c=r[y][v]);){if(0===(h=c.cval)||15===h)return{path:s,info:"mergeable"};i=f[h],o=u[h],n=l[h],5!==h&&10!==h||(5===h?c.flipped?-1===l[w]?(i="left",o=-1,n=0):(i="right",o=1,n=0):-1===u[w]&&(i="bottom",o=0,n=-1):10===h&&(c.flipped?-1===u[w]?(i="top",o=0,n=1):(i="bottom",o=0,n=-1):1===l[w]&&(i="left",o=-1,n=0))),d=g(c,i),s.push([v+d[0],y+d[1]]),p(c),v+=o,y+=n,w=h}return{path:s,info:"closed"}}(r.cells,n,i),s=!1;if("mergeable"===a.info)for(var u=a.path[a.path.length-1][0],l=a.path[a.path.length-1][1],f=t-1;f>=0;f--)if(Math.abs(e[f][0][0]-u)<=1e-7&&Math.abs(e[f][0][1]-l)<=1e-7){for(var c=a.path.length-2;c>=0;--c)e[f].unshift(a.path[c]);s=!0;break}s||(e[t++]=a.path)}var d})}),e}(function(r,e){for(var t=r.length-1,o=r[0].length-1,n={rows:t,cols:o,cells:[]},i=0;i<t;++i){n.cells[i]=[];for(var a=0;a<o;++a){var s=0,u=r[i+1][a],l=r[i+1][a+1],f=r[i][a+1],h=r[i][a];if(!(isNaN(u)||isNaN(l)||isNaN(f)||isNaN(h))){s|=u>=e?8:0,s|=l>=e?4:0,s|=f>=e?2:0;var p,g,d,v,y=!1;if(5===(s|=h>=e?1:0)||10===s){var w=(u+l+f+h)/4;5===s&&w<e?(s=10,y=!0):10===s&&w<e&&(s=5,y=!0)}if(0!==s&&15!==s)p=g=d=v=.5,1===s?(d=1-c(e,u,h),g=1-c(e,f,h)):2===s?(g=c(e,h,f),v=1-c(e,l,f)):3===s?(d=1-c(e,u,h),v=1-c(e,l,f)):4===s?(p=c(e,u,l),v=c(e,f,l)):5===s?(p=c(e,u,l),v=c(e,f,l),g=1-c(e,f,h),d=1-c(e,u,h)):6===s?(g=c(e,h,f),p=c(e,u,l)):7===s?(d=1-c(e,u,h),p=c(e,u,l)):8===s?(d=c(e,h,u),p=1-c(e,l,u)):9===s?(g=1-c(e,f,h),p=1-c(e,l,u)):10===s?(p=1-c(e,l,u),v=1-c(e,l,f),g=c(e,h,f),d=c(e,h,u)):11===s?(p=1-c(e,l,u),v=1-c(e,l,f)):12===s?(d=c(e,h,u),v=c(e,f,l)):13===s?(g=1-c(e,f,h),v=c(e,f,l)):14===s?(d=c(e,h,u),g=c(e,h,f)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),n.cells[i][a]={cval:s,flipped:y,top:p,right:v,bottom:g,left:d}}}}return n}(r,e));return"function"==typeof l.successCallback&&l.successCallback(s),s}function c(r,e,t){return(r-e)/(t-e)}function h(r){return 0===r.cval||15===r.cval}function p(r){h(r)||5===r.cval||10===r.cval||(r.cval=15)}function g(r,e){return"top"===e?[r.top,1]:"bottom"===e?[r.bottom,0]:"right"===e?[1,r.right]:"left"===e?[0,r.left]:void 0}function d(r,e){if(e=e||{},!s.isObject(e))throw new Error("options is invalid");var t=e.zProperty||"elevation",o=e.flip,n=e.flags;a.collectionOf(r,"Point","input must contain Points");for(var u=function(r,e){var t={};return i.featureEach(r,function(r){var e=a.getCoords(r)[1];t[e]||(t[e]=[]),t[e].push(r)}),Object.keys(t).map(function(r){return t[r].sort(function(r,e){return a.getCoords(r)[0]-a.getCoords(e)[0]})}).sort(function(r,t){return e?a.getCoords(r[0])[1]-a.getCoords(t[0])[1]:a.getCoords(t[0])[1]-a.getCoords(r[0])[1]})}(r,o),l=[],f=0;f<u.length;f++){for(var c=u[f],h=[],p=0;p<c.length;p++){var g=c[p];g.properties[t]?h.push(g.properties[t]):h.push(0),!0===n&&(g.properties.matrixPosition=[f,p])}l.push(h)}return l}function v(r,e,t){if(t=t||{},!s.isObject(t))throw new Error("options is invalid");var o=t.zProperty||"elevation",u=t.commonProperties||{},l=t.breaksProperties||[];if(a.collectionOf(r,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!s.isObject(u))throw new Error("commonProperties must be an Object");if(!Array.isArray(l))throw new Error("breaksProperties must be an Array");var c=d(r,{zProperty:o,flip:!0}),h=function(r,e,t){var o=n(t),a=o[2]-o[0],s=o[3]-o[1],u=o[0],l=o[1],f=e[0].length-1,c=e.length-1,h=a/f,p=s/c,g=function(r){r[0]=r[0]*h+u,r[1]=r[1]*p+l};return r.forEach(function(r){i.coordEach(r,g)}),r}(function(r,e,t,o,n){for(var i=[],a=1;a<e.length;a++){var u=+e[a],l=Object.assign({},o,n[a]);l[t]=u;var c=s.multiLineString(f(r,u),l);i.push(c)}return i}(c,e,o,u,l),c,r);return s.featureCollection(h)}r.exports=v,r.exports.default=v},function(r,e,t){var o=t(7);function n(r){var e=[1/0,1/0,-1/0,-1/0];return o.coordEach(r,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}r.exports=n,r.exports.default=n},function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(8);function n(r,e,t){if(null!==r)for(var o,i,a,s,u,l,f,c,h=0,p=0,g=r.type,d="FeatureCollection"===g,v="Feature"===g,y=d?r.features.length:1,w=0;w<y;w++){u=(c=!!(f=d?r.features[w].geometry:v?r.geometry:r)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var m=0;m<u;m++){var b=0,E=0;if(null!==(s=c?f.geometries[m]:f)){l=s.coordinates;var x=s.type;switch(h=!t||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(l,p,w,b,E))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(o=0;o<l.length;o++){if(!1===e(l[o],p,w,b,E))return!1;p++,"MultiPoint"===x&&b++}"LineString"===x&&b++;break;case"Polygon":case"MultiLineString":for(o=0;o<l.length;o++){for(i=0;i<l[o].length-h;i++){if(!1===e(l[o][i],p,w,b,E))return!1;p++}"MultiLineString"===x&&b++,"Polygon"===x&&E++}"Polygon"===x&&b++;break;case"MultiPolygon":for(o=0;o<l.length;o++){for("MultiPolygon"===x&&(E=0),i=0;i<l[o].length;i++){for(a=0;a<l[o][i].length-h;a++){if(!1===e(l[o][i][a],p,w,b,E))return!1;p++}E++}b++}break;case"GeometryCollection":for(o=0;o<s.geometries.length;o++)if(!1===n(s.geometries[o],e,t))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&!1!==e(r.features[t].properties,t);t++);break;case"Feature":e(r.properties,0)}}function a(r,e){if("Feature"===r.type)e(r,0);else if("FeatureCollection"===r.type)for(var t=0;t<r.features.length&&!1!==e(r.features[t],t);t++);}function s(r,e){var t,o,n,i,a,s,u,l,f,c,h=0,p="FeatureCollection"===r.type,g="Feature"===r.type,d=p?r.features.length:1;for(t=0;t<d;t++){for(s=p?r.features[t].geometry:g?r.geometry:r,l=p?r.features[t].properties:g?r.properties:{},f=p?r.features[t].bbox:g?r.bbox:void 0,c=p?r.features[t].id:g?r.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,n=0;n<a;n++)if(null!==(i=u?s.geometries[n]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,f,c))return!1;break;case"GeometryCollection":for(o=0;o<i.geometries.length;o++)if(!1===e(i.geometries[o],h,l,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,f,c))return!1;h++}}function u(r,e){s(r,function(r,t,n,i,a){var s,u=null===r?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(o.feature(r,n,{bbox:i,id:a}),t,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<r.coordinates.length;l++){var f={type:s,coordinates:r.coordinates[l]};if(!1===e(o.feature(f,n),t,l))return!1}})}function l(r,e){u(r,function(r,t,i){var a=0;if(r.geometry){var s,u=r.geometry.type;if("Point"!==u&&"MultiPoint"!==u)return!1!==n(r,function(n,u,l,f,c){if(void 0!==s){var h=o.lineString([s,n],r.properties);if(!1===e(h,t,i,c,a))return!1;a++,s=n}else s=n})&&void 0}})}function f(r,e){if(!r)throw new Error("geojson is required");u(r,function(r,t,n){if(null!==r.geometry){var i=r.geometry.type,a=r.geometry.coordinates;switch(i){case"LineString":if(!1===e(r,t,n,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===e(o.lineString(a[s],r.properties),t,n,s))return!1}}})}e.coordEach=n,e.coordReduce=function(r,e,t,o){var i=t;return n(r,function(r,o,n,a,s){i=0===o&&void 0===t?r:e(i,r,o,n,a,s)},o),i},e.propEach=i,e.propReduce=function(r,e,t){var o=t;return i(r,function(r,n){o=0===n&&void 0===t?r:e(o,r,n)}),o},e.featureEach=a,e.featureReduce=function(r,e,t){var o=t;return a(r,function(r,n){o=0===n&&void 0===t?r:e(o,r,n)}),o},e.coordAll=function(r){var e=[];return n(r,function(r){e.push(r)}),e},e.geomEach=s,e.geomReduce=function(r,e,t){var o=t;return s(r,function(r,n,i,a,s){o=0===n&&void 0===t?r:e(o,r,n,i,a,s)}),o},e.flattenEach=u,e.flattenReduce=function(r,e,t){var o=t;return u(r,function(r,n,i){o=0===n&&0===i&&void 0===t?r:e(o,r,n,i)}),o},e.segmentEach=l,e.segmentReduce=function(r,e,t){var o=t,n=!1;return l(r,function(r,i,a,s,u){o=!1===n&&void 0===t?r:e(o,r,i,a,s,u),n=!0}),o},e.lineEach=f,e.lineReduce=function(r,e,t){var o=t;return f(r,function(r,n,i,a){o=0===n&&void 0===t?r:e(o,r,n,i,a)}),o},e.findSegment=function(r,e){if(e=e||{},!o.isObject(e))throw new Error("options is invalid");var t,n=e.featureIndex||0,i=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.segmentIndex||0,u=e.properties;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),u=u||r.features[n].properties,t=r.features[n].geometry;break;case"Feature":u=u||r.properties,t=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":t=r;break;default:throw new Error("geojson is invalid")}if(null===t)return null;var l=t.coordinates;switch(t.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),o.lineString([l[s],l[s+1]],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s-1),o.lineString([l[a][s],l[a][s+1]],u,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s-1),o.lineString([l[i][s],l[i][s+1]],u,e);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s-1),o.lineString([l[i][a][s],l[i][a][s+1]],u,e)}throw new Error("geojson is invalid")},e.findPoint=function(r,e){if(e=e||{},!o.isObject(e))throw new Error("options is invalid");var t,n=e.featureIndex||0,i=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.coordIndex||0,u=e.properties;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),u=u||r.features[n].properties,t=r.features[n].geometry;break;case"Feature":u=u||r.properties,t=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":t=r;break;default:throw new Error("geojson is invalid")}if(null===t)return null;var l=t.coordinates;switch(t.type){case"Point":return o.point(l,u,e);case"MultiPoint":return i<0&&(i=l.length+i),o.point(l[i],u,e);case"LineString":return s<0&&(s=l.length+s),o.point(l[s],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s),o.point(l[a][s],u,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s),o.point(l[i][s],u,e);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s),o.point(l[i][a][s],u,e)}throw new Error("geojson is invalid")}},function(r,e){Object.defineProperty(e,"__esModule",{value:!0});var t={meters:6371008.8,metres:6371008.8,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:6371008.8/1852,inches:6371008.8*39.37,yards:6371008.8/1.0936,feet:20902260.511392,radians:1,degrees:6371008.8/111325},o={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/6371008.8,degrees:1/111325},n={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:3.86e-7,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function i(r,e,t){if(!y(t=t||{}))throw new Error("options is invalid");var o=t.bbox,n=t.id;if(void 0===r)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");o&&w(o),n&&m(n);var i={type:"Feature"};return n&&(i.id=n),o&&(i.bbox=o),i.properties=e||{},i.geometry=r,i}function a(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!v(r[0])||!v(r[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:r},e,t)}function s(r,e,t){if(!r)throw new Error("coordinates is required");for(var o=0;o<r.length;o++){var n=r[o];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<n[n.length-1].length;a++){if(0===o&&0===a&&!v(n[0][0])||!v(n[0][1]))throw new Error("coordinates must contain numbers");if(n[n.length-1][a]!==n[0][a])throw new Error("First and last Position are not equivalent.")}}return i({type:"Polygon",coordinates:r},e,t)}function u(r,e,t){if(!r)throw new Error("coordinates is required");if(r.length<2)throw new Error("coordinates must be an array of two or more positions");if(!v(r[0][1])||!v(r[0][1]))throw new Error("coordinates must contain numbers");return i({type:"LineString",coordinates:r},e,t)}function l(r,e){if(!y(e=e||{}))throw new Error("options is invalid");var t=e.bbox,o=e.id;if(!r)throw new Error("No features passed");if(!Array.isArray(r))throw new Error("features must be an Array");t&&w(t),o&&m(o);var n={type:"FeatureCollection"};return o&&(n.id=o),t&&(n.bbox=t),n.features=r,n}function f(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiLineString",coordinates:r},e,t)}function c(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiPoint",coordinates:r},e,t)}function h(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiPolygon",coordinates:r},e,t)}function p(r,e){if(null==r)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var o=t[e||"kilometers"];if(!o)throw new Error(e+" units is invalid");return r*o}function g(r,e){if(null==r)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var o=t[e||"kilometers"];if(!o)throw new Error(e+" units is invalid");return r/o}function d(r){if(null==r)throw new Error("radians is required");return 180*(r%(2*Math.PI))/Math.PI}function v(r){return!isNaN(r)&&null!==r&&!Array.isArray(r)}function y(r){return!!r&&r.constructor===Object}function w(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(4!==r.length&&6!==r.length)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(r){if(!v(r))throw new Error("bbox must only contain numbers")})}function m(r){if(!r)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof r))throw new Error("id must be a number or a string")}e.earthRadius=6371008.8,e.factors=t,e.unitsFactors=o,e.areaFactors=n,e.feature=i,e.geometry=function(r,e,t){if(!y(t=t||{}))throw new Error("options is invalid");var o,n=t.bbox;if(!r)throw new Error("type is required");if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");switch(n&&w(n),r){case"Point":o=a(e).geometry;break;case"LineString":o=u(e).geometry;break;case"Polygon":o=s(e).geometry;break;case"MultiPoint":o=c(e).geometry;break;case"MultiLineString":o=f(e).geometry;break;case"MultiPolygon":o=h(e).geometry;break;default:throw new Error(r+" is invalid")}return n&&(o.bbox=n),o},e.point=a,e.points=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return a(r,e)}),t)},e.polygon=s,e.polygons=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return s(r,e)}),t)},e.lineString=u,e.lineStrings=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return u(r,e)}),t)},e.featureCollection=l,e.multiLineString=f,e.multiPoint=c,e.multiPolygon=h,e.geometryCollection=function(r,e,t){if(!r)throw new Error("geometries is required");if(!Array.isArray(r))throw new Error("geometries must be an Array");return i({type:"GeometryCollection",geometries:r},e,t)},e.round=function(r,e){if(null==r||isNaN(r))throw new Error("num is required");if(e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t},e.radiansToLength=p,e.lengthToRadians=g,e.lengthToDegrees=function(r,e){return d(g(r,e))},e.bearingToAzimuth=function(r){if(null==r)throw new Error("bearing is required");var e=r%360;return e<0&&(e+=360),e},e.radiansToDegrees=d,e.degreesToRadians=function(r){if(null==r)throw new Error("degrees is required");return r%360*Math.PI/180},e.convertLength=function(r,e,t){if(null==r)throw new Error("length is required");if(!(r>=0))throw new Error("length must be a positive number");return p(g(r,e),t||"kilometers")},e.convertArea=function(r,e,t){if(null==r)throw new Error("area is required");if(!(r>=0))throw new Error("area must be a positive number");var o=n[e||"meters"];if(!o)throw new Error("invalid original units");var i=n[t||"kilometers"];if(!i)throw new Error("invalid final units");return r/o*i},e.isNumber=v,e.isObject=y,e.validateBBox=w,e.validateId=m,e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}},function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(8);e.getCoord=function(r){if(!r)throw new Error("coord is required");if("Feature"===r.type&&null!==r.geometry&&"Point"===r.geometry.type)return r.geometry.coordinates;if("Point"===r.type)return r.coordinates;if(Array.isArray(r)&&r.length>=2&&void 0===r[0].length&&void 0===r[1].length)return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(r){if(!r)throw new Error("coords is required");if("Feature"===r.type&&null!==r.geometry)return r.geometry.coordinates;if(r.coordinates)return r.coordinates;if(Array.isArray(r))return r;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function r(e){if(e.length>1&&o.isNumber(e[0])&&o.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return r(e[0]);throw new Error("coordinates must only contain numbers")},e.geojsonType=function(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)},e.featureOf=function(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||"Feature"!==r.type||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)},e.collectionOf=function(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||"FeatureCollection"!==r.type)throw new Error("Invalid input to "+t+", FeatureCollection required");for(var o=0;o<r.features.length;o++){var n=r.features[o];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}},e.getGeom=function(r){if(!r)throw new Error("geojson is required");if(void 0!==r.geometry)return r.geometry;if(r.coordinates||r.geometries)return r;throw new Error("geojson must be a valid Feature or Geometry Object")},e.getGeomType=function(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")},e.getType=function(r,e){if(!r)throw new Error((e||"geojson")+" is required");if(r.geometry&&r.geometry.type)return r.geometry.type;if(r.type)return r.type;throw new Error((e||"geojson")+" is invalid")}},function(r,e,t){function o(r){return r&&"object"==typeof r&&"default"in r?r.default:r}var n=o(t(11)),i=o(t(14)),a=t(9),s=t(8);function u(r,e,t){if(t=t||{},!s.isObject(t))throw new Error("options is invalid");var o=t.mask,u=t.properties,l=[];if(null==e)throw new Error("cellSide is required");if(!s.isNumber(e))throw new Error("cellSide is invalid");if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be array");if(4!==r.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(a.getType(o)))throw new Error("options.mask must be a (Multi)Polygon");for(var f=r[0],c=r[1],h=r[2],p=r[3],g=e/i([f,c],[h,c],t)*(h-f),d=e/i([f,c],[f,p],t)*(p-c),v=h-f,y=p-c,w=Math.floor(v/g),m=(y-Math.floor(y/d)*d)/2,b=f+(v-w*g)/2;b<=h;){for(var E=c+m;E<=p;){var x=s.point([b,E],u);o?n(x,o)&&l.push(x):l.push(x),E+=d}b+=g}return s.featureCollection(l)}r.exports=u,r.exports.default=u},function(r,e,t){function o(r){return r&&"object"==typeof r&&"default"in r?r.default:r}var n=o(t(6)),i=o(t(12)),a=o(t(13)),s=t(9);function u(r,e){var t=s.getType(r),o=s.getType(e),u=s.getGeom(r),c=s.getGeom(e);switch(t){case"Point":switch(o){case"MultiPoint":return function(r,e){var t,o=!1;for(t=0;t<e.coordinates.length;t++)if(f(e.coordinates[t],r.coordinates)){o=!0;break}return o}(u,c);case"LineString":return i(u,c,{ignoreEndVertices:!0});case"Polygon":return a(u,c,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(r,e){for(var t=0;t<r.coordinates.length;t++){for(var o=!1,n=0;n<e.coordinates.length;n++)f(r.coordinates[t],e.coordinates[n])&&(o=!0);if(!o)return!1}return!0}(u,c);case"LineString":return function(r,e){for(var t=!1,o=0;o<r.coordinates.length;o++){if(!i(r.coordinates[o],e))return!1;t||(t=i(r.coordinates[o],e,{ignoreEndVertices:!0}))}return t}(u,c);case"Polygon":return function(r,e){for(var t=!0,o=0;o<r.coordinates.length;o++){var n=a(r.coordinates[1],e);if(!n){t=!1;break}n=a(r.coordinates[1],e,{ignoreBoundary:!0})}return t&&n}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(r,e){for(var t=0;t<r.coordinates.length;t++)if(!i(r.coordinates[t],e))return!1;return!0}(u,c);case"Polygon":return function(r,e){var t=n(e),o=n(r);if(!l(t,o))return!1;for(var i=!1,s=0;s<r.coordinates.length-1;s++){if(!a(r.coordinates[s],e))return!1;if(i||(i=a(r.coordinates[s],e,{ignoreBoundary:!0})),!i){var u=(f=r.coordinates[s],c=r.coordinates[s+1],[(f[0]+c[0])/2,(f[1]+c[1])/2]);i=a(u,e,{ignoreBoundary:!0})}}var f,c;return i}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":return function(r,e){var t=n(r);if(!l(n(e),t))return!1;for(var o=0;o<r.coordinates[0].length;o++)if(!a(r.coordinates[0][o],e))return!1;return!0}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+t+" geometry not supported")}}function l(r,e){return!(r[0]>e[0])&&(!(r[2]<e[2])&&(!(r[1]>e[1])&&!(r[3]<e[3])))}function f(r,e){return r[0]===e[0]&&r[1]===e[1]}r.exports=u,r.exports.default=u},function(r,e,t){var o=t(9),n=t(8);function i(r,e,t){var i=(t=t||{}).ignoreEndVertices;if(!n.isObject(t))throw new Error("invalid options");if(!r)throw new Error("pt is required");if(!e)throw new Error("line is required");for(var s=o.getCoord(r),u=o.getCoords(e),l=0;l<u.length-1;l++){var f=!1;if(i&&(0===l&&(f="start"),l===u.length-2&&(f="end"),0===l&&l+1===u.length-1&&(f="both")),a(u[l],u[l+1],s,f))return!0}return!1}function a(r,e,t,o){var n=t[0],i=t[1],a=r[0],s=r[1],u=e[0],l=e[1],f=u-a,c=l-s;return 0==(t[0]-a)*c-(t[1]-s)*f&&(o?"start"===o?Math.abs(f)>=Math.abs(c)?f>0?a<n&&n<=u:u<=n&&n<a:c>0?s<i&&i<=l:l<=i&&i<s:"end"===o?Math.abs(f)>=Math.abs(c)?f>0?a<=n&&n<u:u<n&&n<=a:c>0?s<=i&&i<l:l<i&&i<=s:"both"===o?Math.abs(f)>=Math.abs(c)?f>0?a<n&&n<u:u<n&&n<a:c>0?s<i&&i<l:l<i&&i<s:void 0:Math.abs(f)>=Math.abs(c)?f>0?a<=n&&n<=u:u<=n&&n<=a:c>0?s<=i&&i<=l:l<=i&&i<=s)}r.exports=i,r.exports.default=i},function(r,e,t){var o=t(9);function n(r,e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var n=t.ignoreBoundary;if(!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");var a=o.getCoord(r),s=o.getCoords(e),u=e.geometry?e.geometry.type:e.type,l=e.bbox;if(l&&!1===function(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}(a,l))return!1;"Polygon"===u&&(s=[s]);for(var f=0,c=!1;f<s.length&&!c;f++)if(i(a,s[f][0],n)){for(var h=!1,p=1;p<s[f].length&&!h;)i(a,s[f][p],!n)&&(h=!0),p++;h||(c=!0)}return c}function i(r,e,t){var o=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,i=e.length-1;n<e.length;i=n++){var a=e[n][0],s=e[n][1],u=e[i][0],l=e[i][1];if(r[1]*(a-u)+s*(u-r[0])+l*(r[0]-a)==0&&(a-r[0])*(u-r[0])<=0&&(s-r[1])*(l-r[1])<=0)return!t;s>r[1]!=l>r[1]&&r[0]<(u-a)*(r[1]-s)/(l-s)+a&&(o=!o)}return o}r.exports=n,r.exports.default=n},function(r,e,t){var o=t(9),n=t(8);function i(r,e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var i=t.units,a=o.getCoord(r),s=o.getCoord(e),u=n.degreesToRadians(s[1]-a[1]),l=n.degreesToRadians(s[0]-a[0]),f=n.degreesToRadians(a[1]),c=n.degreesToRadians(s[1]),h=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(f)*Math.cos(c);return n.radiansToLength(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),i)}r.exports=i,r.exports.default=i},function(r,e,t){var o=t(8),n=t(9),i=function(r){this.points=r.points||[],this.duration=r.duration||1e4,this.sharpness=r.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=r.stepLength||60,this.length=this.points.length,this.delay=0;for(var e=0;e<this.length;e++)this.points[e].z=this.points[e].z||0;for(e=0;e<this.length-1;e++){var t=this.points[e],o=this.points[e+1];this.centers.push({x:(t.x+o.x)/2,y:(t.y+o.y)/2,z:(t.z+o.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(e=0;e<this.centers.length-1;e++){t=this.centers[e],o=this.centers[e+1];var n=this.points[e+1].x-(this.centers[e].x+this.centers[e+1].x)/2,i=this.points[e+1].y-(this.centers[e].y+this.centers[e+1].y)/2,a=this.points[e+1].z-(this.centers[e].y+this.centers[e+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e].x+n),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e].y+i),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e].z+a)},{x:(1-this.sharpness)*this.points[e+1].x+this.sharpness*(this.centers[e+1].x+n),y:(1-this.sharpness)*this.points[e+1].y+this.sharpness*(this.centers[e+1].y+i),z:(1-this.sharpness)*this.points[e+1].z+this.sharpness*(this.centers[e+1].z+a)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this};function a(r,e){if(e=e||{},!o.isObject(e))throw new Error("options is invalid");var t=e.resolution||1e4,a=e.sharpness||.85;if(!r)throw new Error("line is required");if(!o.isNumber(t))throw new Error("resolution must be an number");if(!o.isNumber(a))throw new Error("sharpness must be an number");for(var s=[],u=new i({points:n.getGeom(r).coordinates.map(function(r){return{x:r[0],y:r[1]}}),duration:t,sharpness:a}),l=0;l<u.duration;l+=10){var f=u.pos(l);Math.floor(l/100)%2==0&&s.push([f.x,f.y])}return o.lineString(s,r.properties)}i.prototype.cacheSteps=function(r){var e=[],t=this.pos(0);e.push(0);for(var o=0;o<this.duration;o+=10){var n=this.pos(o);Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y)+(n.z-t.z)*(n.z-t.z))>r&&(e.push(o),t=n)}return e},i.prototype.vector=function(r){var e=this.pos(r+10),t=this.pos(r-10);return{angle:180*Math.atan2(e.y-t.y,e.x-t.x)/3.14,speed:Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)+(t.z-e.z)*(t.z-e.z))}},i.prototype.pos=function(r){var e=r-this.delay;e<0&&(e=0),e>this.duration&&(e=this.duration-1);var t=e/this.duration;if(t>=1)return this.points[this.length-1];var o=Math.floor((this.points.length-1)*t);return function(r,e,t,o,n){var i=function(r){var e=r*r;return[e*r,3*e*(1-r),3*r*(1-r)*(1-r),(1-r)*(1-r)*(1-r)]}(r);return{x:n.x*i[0]+o.x*i[1]+t.x*i[2]+e.x*i[3],y:n.y*i[0]+o.y*i[1]+t.y*i[2]+e.y*i[3],z:n.z*i[0]+o.z*i[1]+t.z*i[2]+e.z*i[3]}}((this.length-1)*t-o,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])},r.exports=a,r.exports.default=a}]);var i=function(){var r={},e=function(r,e){var t,o=new Array(e*e).fill(0);for(t=0;t<e;t++)o[t*e+t]=r;return o},t=function(r,e,t,o){var n,i,a=Array(t*o);for(n=0;n<t;n++)for(i=0;i<o;i++)a[n*o+i]=r[n*o+i]+e[n*o+i];return a},o=function(r,e,t,o,n){var i,a,s,u=Array(t*n);for(i=0;i<t;i++)for(a=0;a<n;a++)for(u[i*n+a]=0,s=0;s<o;s++)u[i*n+a]+=r[i*o+s]*e[s*n+a];return u},n=function(r,e){var t,o,n,i=Array(e);for(t=0;t<e;t++)i[t]=r[t*e+t];for(t=0;t<e;t++){for(o=0;o<t;o++)i[t]-=r[t*e+o]*r[t*e+o];if(i[t]<=0)return!1;for(i[t]=Math.sqrt(i[t]),o=t+1;o<e;o++){for(n=0;n<t;n++)r[o*e+t]-=r[o*e+n]*r[t*e+n];r[o*e+t]/=i[t]}}for(t=0;t<e;t++)r[t*e+t]=i[t];return!0},i=function(r,e){var t,o,n,i;for(t=0;t<e;t++)for(r[t*e+t]=1/r[t*e+t],o=t+1;o<e;o++){for(i=0,n=t;n<o;n++)i-=r[o*e+n]*r[n*e+t];r[o*e+t]=i/r[o*e+o]}for(t=0;t<e;t++)for(o=t+1;o<e;o++)r[t*e+o]=0;for(t=0;t<e;t++){for(r[t*e+t]*=r[t*e+t],n=t+1;n<e;n++)r[t*e+t]+=r[n*e+t]*r[n*e+t];for(o=t+1;o<e;o++)for(n=o;n<e;n++)r[t*e+o]+=r[n*e+t]*r[n*e+o]}for(t=0;t<e;t++)for(o=0;o<t;o++)r[t*e+o]=r[o*e+t]},a=function(r,e){var t,o,n,i,a,s,u,l,f,c,h,p=e,g=Array(e*e),d=Array(e),v=Array(e),y=Array(e);for(t=0;t<e;t++)for(i=0;i<e;i++)g[t*e+i]=t==i?1:0;for(i=0;i<e;i++)y[i]=0;for(t=0;t<e;t++){for(l=0,i=0;i<e;i++)if(1!=y[i])for(a=0;a<e;a++)0==y[a]&&Math.abs(r[i*e+a])>=l&&(l=Math.abs(r[i*e+a]),n=i,o=a);if(++y[o],n!=o){for(s=0;s<e;s++)h=r[n*e+s],r[n*e+s]=r[o*e+s],r[o*e+s]=h;for(s=0;s<p;s++)h=g[n*e+s],g[n*e+s]=g[o*e+s],g[o*e+s]=h}if(v[t]=n,d[t]=o,0==r[o*e+o])return!1;for(c=1/r[o*e+o],r[o*e+o]=1,s=0;s<e;s++)r[o*e+s]*=c;for(s=0;s<p;s++)g[o*e+s]*=c;for(u=0;u<e;u++)if(u!=o){for(f=r[u*e+o],r[u*e+o]=0,s=0;s<e;s++)r[u*e+s]-=r[o*e+s]*f;for(s=0;s<p;s++)g[u*e+s]-=g[o*e+s]*f}}for(s=e-1;s>=0;s--)if(v[s]!=d[s])for(a=0;a<e;a++)h=r[a*e+v[s]],r[a*e+v[s]]=r[a*e+d[s]],r[a*e+d[s]]=h;return!0},s=function(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*Math.pow(r/t,2)))},u=function(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*(r/t)))},l=function(r,e,t,o,n){return r>t?e+(o-e)/t:e+(o-e)/t*(r/t*1.5-.5*Math.pow(r/t,3))};return r.train=function(r,f,c,h,p,g){var d={t:r,x:f,y:c,nugget:0,range:0,sill:0,A:1/3,n:0};switch(h){case"gaussian":d.model=s;break;case"exponential":d.model=u;break;case"spherical":d.model=l}var v,y,w,m,b=r.length,E=Array((b*b-b)/2);for(v=0,w=0;v<b;v++)for(y=0;y<v;y++,w++)E[w]=Array(2),E[w][0]=Math.pow(Math.pow(f[v]-f[y],2)+Math.pow(c[v]-c[y],2),.5),E[w][1]=Math.abs(r[v]-r[y]);E.sort(function(r,e){return r[0]-e[0]}),d.range=E[(b*b-b)/2-1][0];var x=(b*b-b)/2>30?30:(b*b-b)/2,M=d.range/x,P=new Array(x).fill(0),k=new Array(x).fill(0);if(x<30)for(m=0;m<x;m++)P[m]=E[m][0],k[m]=E[m][1];else{for(v=0,y=0,w=0,m=0;v<x&&y<(b*b-b)/2;v++,w=0){for(;E[y][0]<=(v+1)*M&&(P[m]+=E[y][0],k[m]+=E[y][1],w++,!(++y>=(b*b-b)/2)););w>0&&(P[m]/=w,k[m]/=w,m++)}if(m<2)return d}b=m,d.range=P[b-1]-P[0];var S=new Array(2*b).fill(1),A=Array(b),L=d.A;for(v=0;v<b;v++){switch(h){case"gaussian":S[2*v+1]=1-Math.exp(-1/L*Math.pow(P[v]/d.range,2));break;case"exponential":S[2*v+1]=1-Math.exp(-1/L*P[v]/d.range);break;case"spherical":S[2*v+1]=P[v]/d.range*1.5-.5*Math.pow(P[v]/d.range,3)}A[v]=k[v]}var O=function(r,e,t){var o,n,i=Array(t*e);for(o=0;o<e;o++)for(n=0;n<t;n++)i[n*e+o]=r[o*t+n];return i}(S,b,2),C=o(O,S,2,b,2),I=(C=t(C,e(1/g,2),2,2)).slice(0);n(C,2)?i(C,2):(a(I,2),C=I);var j=o(o(C,O,2,2,b),A,2,b,1);d.nugget=j[0],d.sill=j[1]*d.range+d.nugget,d.n=f.length,b=f.length;var T=Array(b*b);for(v=0;v<b;v++){for(y=0;y<v;y++)T[v*b+y]=d.model(Math.pow(Math.pow(f[v]-f[y],2)+Math.pow(c[v]-c[y],2),.5),d.nugget,d.range,d.sill,d.A),T[y*b+v]=T[v*b+y];T[v*b+v]=d.model(0,d.nugget,d.range,d.sill,d.A)}var q=t(T,e(p,b),b,b),G=q.slice(0);n(q,b)?i(q,b):(a(G,b),q=G);T=q.slice(0);var z=o(q,r,b,b,1);return d.K=T,d.M=z,d},r.predict=function(r,e,t){var n,i=Array(t.n);for(n=0;n<t.n;n++)i[n]=t.model(Math.pow(Math.pow(r-t.x[n],2)+Math.pow(e-t.y[n],2),.5),t.nugget,t.range,t.sill,t.A);return o(i,t.M,1,t.n,1)[0]},r}();const a=function(r,e){for(var t=r[0],o=r[1],n=!1,i=0,a=e.length-1;i<e.length;a=i++){var s=e[i][0],u=e[i][1],l=e[a][0],f=e[a][1];u>o!=f>o&&t<(l-s)*(o-u)/(f-u)+s&&(n=!n)}return n},s=function(r,e){return r[0]==e[0]&&r[1]==e[1]};var u=function(r,e,t,o,n,i,a){a=a||[];for(var l,f,c,h,p=o[o.length-1],g="t"==n||"b"==n?0:1,d="t"==n||"l"==n?1:-1,v=i?-1:1,y=0;t[n][y];y++){var w=t[n][y],m=(w.p[g]-p[g])*d*v;m>0&&(!l||l&&f>m)&&(l=w,f=m)}if(l)s(l.p,o[0])?o.push(l.p):(h=function(r){return JSON.parse(JSON.stringify(r))}(r[l.coor].coor),l.d&&h.reverse(),o=o.concat(h)),c=l.t;else if(i)switch(n){case"t":o.push(e.sa),c="l";break;case"r":o.push(e.sb),c="t";break;case"b":o.push(e.sc),c="r";break;case"l":o.push(e.sd),c="b"}else switch(n){case"t":o.push(e.sb),c="r";break;case"r":o.push(e.sc),c="b";break;case"b":o.push(e.sd),c="l";break;case"l":o.push(e.sa),c="t"}return o.length>1&&s(o[0],o[o.length-1])?[o].concat(a):(l&&h&&(a=u(r,e,t,h,c,!i,a)),o=u(r,e,t,o,c,i,a))};const l=function(r,e,t){for(var o=!1,n=0,i=r.length;n<i;n++){if(e<r[n].value){if(!o){o=JSON.parse(JSON.stringify(r[n]));break}var a=(e-o.value)/(r[n].value-o.value),s=function(e){return t?parseInt(o[e]+(r[n][e]-o[e])*a):r[n][e]};o.r=s("r"),o.g=s("g"),o.b=s("b");break}o=JSON.parse(JSON.stringify(r[n]))}return o},f=Math.abs,c=Math.max,h=Math.min,p=Math.floor,g=function(r,e){return f(r-e)},d=function(r,e){for(var t=0,o=c(g(e[0],e[2]),g(e[1],e[3])),n=0;n<4;n++){var i=g(e[n],r[n%2]);i<o&&(o=i,t=n)}return"lbrt".charAt(t)},v=function(r,e){return r[0]==e[0]&&r[1]==e[1]},y=function(r){return JSON.parse(JSON.stringify(r))};function w(r,e,t,o){for(var n,i=[],s=[],g={t:[],b:[],l:[],r:[]},w=r.features,m=0,b=w.length;m<b;m++)for(var E=w[m],x=0,M=(X=E.geometry.coordinates).length;x<M;x++){var P=X[x],k=P[0],S=P[P.length-1];if(v(k,S))i.push({coor:P,properties:E.properties,child:[],parent:[],i:i.length});else{s.push({coor:P,properties:E.properties});var A=d(k,e),L=d(S,e);g[A].push({p:k,end:S,d:0,t:L,coor:s.length-1}),g[L].push({p:S,end:k,d:1,t:A,coor:s.length-1})}}for(var O={sa:[e[0],e[3]],sb:[e[2],e[3]],sc:[e[2],e[1]],sd:[e[0],e[1]]},C=(m=0,(n=u(s,O,g,[O.sa],"t",!1)).length);m<C;m++)i.push({coor:n[m],properties:{type:"open"},child:[],parent:[],i:i.length});for(m=0,b=i.length;m<b;m++)for(var I=m+1;I<b;I++){var j=i[m].properties.type,T=i[I].properties.type;"open"!=j&&a(i[m].coor[0],i[I].coor)?(i[I].child.push(m),i[m].parent.push(I)):"open"!=T&&a(i[I].coor[0],i[m].coor)&&(i[m].child.push(I),i[I].parent.push(m))}var q=y(i),G=[],z=[],N=[],R=function(){if(q.length){for(var r=[],e=0,t=q.length;e<t;e++){for(var o=q[e],n=o.child,i=1,a=n.length-1;a>-1;a--)-1==z.indexOf(n[a])&&(i=0);if(i){var s=[];for(a=n.length-1;a>-1;a--){var u=N.indexOf(n[a]);u>-1&&(s.push(n[a]),N.splice(u,1))}N.push(o.i),z.push(o.i),q[e].child=s,G.push(q[e])}else r.push(q[e])}r.length&&(q=r,R())}};R();var F=[],_=t.features,W=_.length,J=_[0].geometry.coordinates,D=1,B=1,U=1;for(m=0;m<W;m++){var V=_[m].geometry.coordinates;if(1==m&&(U=f(V[1]-J[1])),V[0]!=J[0]){D=m,B=f(V[0]-J[0]);break}}for(m=0,b=G.length;m<b;m++){for(var X,Y=[(X=G[m]).coor],K="rgba(0, 0, 0, 0)",H=(I=0,X.child.length);I<H;I++)Y.push(i[X.child[I]].coor);var Q,Z=p(X.coor.length/2),$=X.coor[Z],rr=($[0]-J[0])/B,er=c(p(rr)*D+p(($[1]-J[1])/U),0),tr=rr%1?0:1,or=tr?1:D,nr=tr?U:B,ir=nr/100;if(_[er]&&_[er+or]){var ar=_[er].geometry.coordinates,sr=_[er+or].geometry.coordinates,ur=Object.assign([],$,[]);ur[tr]=c($[tr]-ir,ar[tr]);var lr=_[er].properties.val,fr=_[er+or].properties.val;a(ur,X.coor)?Q=lr+(fr-lr)*(f(ur[tr]-_[er].geometry.coordinates[tr])/nr):(ur[tr]=h($[tr]+2*ir,sr[tr]),a(ur,X.coor)&&(Q=lr+(fr-lr)*(f(ur[tr]-_[er].geometry.coordinates[tr])/nr)))}else _[er]&&(Q=_[er].properties.val);if(null!=Q){var cr=l(o,Q,!1);K="rgb("+cr.r+","+cr.g+","+cr.b+")",Q=cr.value}F.push({geometry:{coordinates:Y,type:"MultiLineString"},properties:{val:Q,color:K},type:"Feature"})}return{features:F,type:"FeatureCollection"}}var m={direction:"vertical",backgroundColor:"#fff",color:"#333",gradient:!0};function b(r,e){if(r.legend<2)return!1;var t=(e=Object.assign({},m,e)).gradient?1:0,o="horizontal"==e.direction?0:1,n=e.title||"",i=e.shape||"rect",a=document.createElement("canvas"),s=o?120:340;t||(s+=20);var u=o?240:50;a.width=s,a.height=u;var l=o?[15,30,20,200]:[70,5,200,20],f=o?[l[0],l[1]+l[3],l[0],l[1]]:[l[0],l[1],l[0]+l[2],l[1]],c=a.getContext("2d");c.lineWidth=1,c.strokeStyle="#999",c.fillStyle=e.backgroundColor,c.fillRect(0,0,s,u),c.font="12px 微软雅黑",c.textBaseline="middle",c.textAlign="start",c.fillStyle=e.color;for(var h=c.createLinearGradient(f[0],f[1],f[2],f[3]),p=0,g=r.length;p<g;p++){var d=r[p].color,v=r[p].unit||"",y=r[p].value+v,w=1/(g-1)*p;if(!t&&p>0&&p<g-1){var b=r[p-1].color;h.addColorStop(w,b),h.addColorStop(w,d)}else h.addColorStop(w,d);if(o)c.fillText(y,l[0]+l[2]+5,l[1]+l[3]*(1-w));else if(!p||p==g-1){var E=c.measureText(y).width,x=l[1]+l[3]/2,M=p?l[0]+l[2]+5:l[0]-5-E;c.fillText(y,M,x)}}switch(c.fillStyle=h,i){case"triangle-rect":if(o){var P=l[2]/2;c.beginPath(),c.moveTo(l[0]+P,l[1]),c.lineTo(l[0]+l[2],l[1]+P),c.lineTo(l[0]+l[2],l[1]+l[3]-P),c.lineTo(l[0]+P,l[1]+l[3]),c.lineTo(l[0],l[1]+l[3]-P),c.lineTo(l[0],l[1]+P),c.lineTo(l[0]+P,l[1]),c.stroke(),c.fill()}else{P=l[3]/2;c.beginPath(),c.moveTo(l[0],l[1]+P),c.lineTo(l[0]+P,l[1]),c.lineTo(l[0]+l[2]-P,l[1]),c.lineTo(l[0]+l[2],l[1]+P),c.lineTo(l[0]+l[2]-P,l[1]+l[3]),c.lineTo(l[0]+P,l[1]+l[3]),c.lineTo(l[0],l[1]+P),c.stroke(),c.fill()}break;default:c.fillRect(l[0],l[1],l[2],l[3])}return n.length&&(c.font="14px 微软雅黑",c.fillStyle=e.color,c.textBaseline="top",o?(c.textAlign="start",c.fillText(n,5,5)):(c.textAlign="center",c.fillText(n,s/2,l[1]+l[3]+5))),a}function E(r,e,t,o){console.log(o);var n=null==(o=o||{}).gradient||o.gradient,i=r.size,a=r.cellWidth,s=r.level,u=r.ex,f=o.filter,c=o.width||1e3,h=Math.abs(c/i[0]*i[1]),p=document.createElement("canvas");p.width=c,p.height=h;var g=p.getContext("2d");if(g.clearRect(0,0,c,h),n)for(var d=e.features,v=Math.abs(a/i[0]*c),y=Math.abs(a/i[1]*h),w=0,m=d.length;w<m;w++){var b=d[w].geometry.coordinates,E=(b[0]-u[0][0])/i[0]*c-v/2,x=(b[1]-u[0][1])/i[1]*h-y/2,M=l(s,d[w].properties.val,n),P=M.value;f&&f.indexOf&&-1==f.indexOf(P)||(g.strokeStyle=g.fillStyle="rgb("+M.r+","+M.g+","+M.b+")",g.beginPath(),g.fillRect(E-1,x-1,v+2,y+2))}else{var k=t.features;for(w=0,m=k.length;w<m;w++){P=k[w].properties.val;if(!f||!f.indexOf||-1!=f.indexOf(P)){var S=k[w].geometry.coordinates;g.strokeStyle=g.fillStyle=k[w].properties.color,g.beginPath();for(var A=0,L=S.length;A<L;A++)for(var O=0,C=S[A].length;O<C;O++){E=(S[A][O][0]-u[0][0])/i[0]*c,x=(S[A][O][1]-u[0][1])/i[1]*h;g[O?"lineTo":"moveTo"](E,x)}g.fill("evenodd")}}}return p}function x(r,e,t){t=t||{};var o=r.size,n=r.ex,i=t.width||1e3,a=Math.abs(i/o[0]*o[1]),s=t.isolineColor||"#333",u=t.filter,l=document.createElement("canvas");l.width=i,l.height=a;var f=l.getContext("2d");f.clearRect(0,0,i,a),f.lineWidth=1,f.font="12px 微软雅黑",f.textBaseline="middle",f.textAlign="center";for(var c=e.features,h={},p=0,g=c.length;p<g;p++){var d=c[p].properties.val;if(!u||!u.indexOf||-1!=u.indexOf(d)){var v=c[p].geometry.coordinates,y="level"==s?c[p].properties.color:s;f.strokeStyle=f.fillStyle=y;for(var w=0,m=v.length;w<m;w++){f.beginPath();for(var b=0,E=0,x=v[w].length;E<x;E++){var M=(v[w][E][0]-n[0][0])/o[0]*i,P=(v[w][E][1]-n[0][1])/o[1]*a;f[E?"lineTo":"moveTo"](M,P);var k=Math.round(M/16)+"-"+Math.round(P/16);h[k]||b||(h[k]=1,b=1,f.fillText(d,M,P))}f.stroke()}}}return l}const M=Object.prototype.toString,P=function(r){return"[object Array]"===M.call(r)};function k(r,e,t){if(!r[0])return!1;var o=(t=t||{}).opacity||1,n=r[0].width,i=r[0].height,a=document.createElement("canvas");a.width=n,a.height=i;var s=a.getContext("2d");s.clearRect(0,0,n,i),s.globalAlpha=o,s.strokeStyle=t.clipColor||"#333",s.lineWidth=t.clipWidth||1;var u=e.clip;if(u&&P(u)){var l=e.ex,f=e.size,c=e.key||{},h=c.clipX||0,p=c.clipY||1;s.beginPath();var g=function(r){if(P(r[0])&&P(r[0][0]))for(var e=0,t=r.length;e<t;e++)g(r[e]);else if(P(r))for(e=0,t=r.length;e<t;e++){var o=(r[e][h]-l[0][0])/f[0]*n,a=(r[e][p]-l[0][1])/f[1]*i;s[e?"lineTo":"moveTo"](o,a)}};g(u),t.clip&&s.stroke(),s.clip()}for(var d=0;r[d];d++){var v=s.createPattern(r[d],"no-repeat");s.fillStyle=v,s.fillRect(0,0,n,i)}return a}const S=function(r,e){if(!e)return[r[1],r[0]];e--;for(var t=0,o=r.length;t<o;t++)r[t]=S(r[t],e);return r},A=function(r){for(var e=function(r){return JSON.parse(JSON.stringify(r))}(r),t=0,o=e.features.length;t<o;t++){var n=e.features[t].geometry.coordinates;e.features[t].geometry.coordinates=S(n,2)}return e};function O(r,e,t,o){if(r&&t){for(var n=[],i=o.filter,a=0;r.features[a];a++){var s=r.features[a],u=s.properties.val;if(!(i&&i.indexOf&&-1==i.indexOf(u)||!s.geometry.coordinates.length)){var l=Object.assign({},{stroke:!0,weight:1,opacity:.7,fillOpacity:.7,color:s.properties.color,fillColor:s.properties.color,renderer:t},o),f=L[e](s.geometry.coordinates,l);n.push(f)}}return n}}const C=Object.prototype.toString,I=function(r){return"[object Array]"===C.call(r)};const j="IsoImage",T="image/png",q=Object.prototype.toString,G="ActiveXObject"in window,z=Math.min,N=Math.max,R=Math.abs,F=Math.round,_={x:"x",y:"y",v:"v",clipX:"0",clipY:"1"},W=function(){var r="L"in window;return r||console.log("未加载leaflet"),r};function J(r,e,t){this.name=j,this.initialize(r,e,t),this.getIsosurface=function(r,e){if(!this.alow())return!1;var t=k([E(this.option,this.pointGrid,this.isosurface,r)],this.option,r);return e?t:t.toDataURL(T)},this.getIsoline=function(r,e){if(!this.alow())return!1;var t=k([x(this.option,this.isoline,r)],this.option,r);return e?t:t.toDataURL(T)},this.getIsoImage=function(r,e){if(!this.alow())return!1;var t=k([E(this.option,this.pointGrid,this.isosurface,r),x(this.option,this.isoline,r)],this.option,r);return e?t:t.toDataURL(T)},this.getLegend=function(r,e){var t=b(this.option.level||[],r);return!!t&&(e?t:t.toDataURL("image/png"))},this.layer=function(r){if(W())return function(r){return L.IsoImageCanvasLayer||(L.IsoImageCanvasLayer=L.Canvas.extend({})),new L.IsoImageCanvasLayer(r)}(r=Object.assign({},{padding:.5},r))},this.drawIsosurface=function(r,e){if(W()){var t=O(this.fmtLatlngsIsosurface,"polygon",r,e);return L.featureGroup(t)}},this.drawIsoline=function(r,e){if(W()){var t=O(this.fmtLatlngsIsoline,"polyline",r,e);return L.featureGroup(t)}},this.drawIsoImage=function(r,e){if(W()){var t=this.fmtLatlngsIsosurface,o=this.fmtLatlngsIsoline,n=O(t,"polygon",r,e),i=O(o,"polyline",r,e),a=n.concat(i);return L.featureGroup(a)}},this.drawLegend=function(r){if(W()){r=Object.assign({},{position:"bottomleft",gradient:!0},r);var e=b(this.option.level||[],r);return!!e&&(r.canvas=e,function(r){return L.Control.IsoLegendCortrol||(L.Control.IsoLegendCortrol=L.Control.extend({options:{position:"bottomleft",canvas:""},initialize:function(r){L.Util.extend(this.options,r)},onAdd:function(r){return this._container=L.DomUtil.create("div","leaflet-control-iso-legend"),this._container.appendChild(this.options.canvas),this._container}})),new L.Control.IsoLegendCortrol(r)}(r))}}}return J.prototype={constructor:J,initialize:function(r,e,t){this.turfIsolines=e.turfIsolines||window.turfIsolines,this.turfPointGrid=e.turfPointGrid||window.turfPointGrid;var o=e.extent,n=e.level;if(!o)return console.log("缺少参数extent(画布左上右下坐标)");if(!n)return console.log("缺少参数level(色阶)");n=function(r){for(var e=0,t=r.length;e<t;e++){var o=r[e].color;r[e].r=parseInt(o.substr(1,2),16),r[e].g=parseInt(o.substr(3,2),16),r[e].b=parseInt(o.substr(5,2),16)}return r}(n);var i=[z(o[0][0],o[1][0]),z(o[0][1],o[1][1]),N(o[0][0],o[1][0]),N(o[0][1],o[1][1])],a=[o[1][0]-o[0][0],o[1][1]-o[0][1]],s=e.cellWidth||F(R(a[0])/200*1e6)/1e6;G&&(s*=3);var u=Object.assign({},_,e.keyConfig);this.option={worker:e.worker,type:e.type||"idw",pow:e.pow||3,model:e.model||"spherical",clip:e.clip,smooth:e.smooth,ex:o,extent:i,size:a,cellWidth:s,level:n,key:u};var l=[],f=[],c=[],h=[];if(function(r){return"[object Array]"===q.call(r)}(r))for(var p=0,g=r.length;p<g;p++)if(null!=r[p][u.v]){var d=r[p][u.v],v=r[p][u.x],y=r[p][u.y];l.push({x:v,y:y,v:d}),f.push(d),c.push(v),h.push(y)}this.points=l,this._v=f,this._x=c,this._y=h;var w=this;if(e.worker&&window.Worker){var m=new Worker(e.worker+"/turf.js");return m.onmessage=function(r){w.pointGrid=r.data,w.calcGridValue(),t&&w.initReady(t)},void m.postMessage(["pointGrid",i,s,{units:"degrees"}])}this.pointGrid=this.turfPointGrid(i,s,{units:"degrees"}),this.calcGridValue(),t&&this.initReady(t)},calcGridValue:function(){var r=this.option,e=this.pointGrid,t=this._v,o=this._x,n=this._y,a=r.model;switch(r.type){case"kriging":if(r.worker&&window.Worker){var s=new Worker(r.worker+"/"+r.type+".js"),u=this;return s.onmessage=function(r){u.pointGrid=r.data,u.pointGridState=!0,u.calcIso()},void s.postMessage([e,t,o,n,a,.1,100])}for(var l=i.train(t,o,n,a,.1,100),f=0;f<e.features.length;f++){var c=i.predict(e.features[f].geometry.coordinates[0],e.features[f].geometry.coordinates[1],l);e.features[f].properties.val=c}this.pointGridState=!0,this.calcIso();break;default:var h=this.points;if(r.worker&&window.Worker){var p=new Worker(r.worker+"/"+r.type+".js");u=this;return p.onmessage=function(r){u.pointGrid=r.data,u.pointGridState=!0,u.calcIso()},void p.postMessage([h,e,r.pow])}this.pointGrid=function(r,e,t){null==t&&(t=3);var o=e.features;if(r.length<3)return e;for(var n=r.length,i=o.length,a=[],s=0;s<i;s++)for(var u=0;u<n;u++){var l=Math.sqrt(Math.pow(o[s].geometry.coordinates[0]-r[u].x,2)+Math.pow(o[s].geometry.coordinates[1]-r[u].y,2));a.push(l)}for(s=0;s<i;s++){var f=!1;for(u=n*s;u<n*s+n;u++)if(Math.abs(a[u])<1e-4){o[s].properties.val=r[u-n*s].v,f=!0;break}if(!f){var c=0,h=0;for(u=n*s;u<n*s+n;u++)c+=r[u-n*s].v/Math.pow(a[u],t),h+=1/Math.pow(a[u],t);o[s].properties.val=c/h}}return e}(h,e,r.pow),this.pointGridState=!0,this.calcIso()}},calcIso:function(){for(var r=this.option,e=this.pointGrid,t=r.level,o=[],n=this,i=0,a=t.length;i<a;i++)o.push(t[i].value);if(r.worker&&window.Worker){var s=new Worker(r.worker+"/turf.js");n=this;return s.onmessage=function(o){var i=o.data;n.isoline=i,n.isosurface=w(i,r.extent,e,t),n.fmtLatlngsIsoline=A(n.isoline),n.fmtLatlngsIsosurface=A(n.isosurface),n.isoLinesState=!0},void s.postMessage(["isolines",e,o,{zProperty:"val"},t])}var u=this.turfIsolines(e,o,{zProperty:"val"}),l=u.features;for(i=0,a=l.length;i<a;i++)for(var f=l[i].properties.val,c=0;t[c];c++)if(t[c].value==f){l[i].properties.color=t[c].color;break}this.isoline=u,this.isosurface=w(u,r.extent,e,t),this.fmtLatlngsIsoline=A(this.isoline),this.fmtLatlngsIsosurface=A(this.isosurface),this.isoLinesState=!0},alow:function(){return this.pointGrid&&this.isoline},initReady:function(r,e){var t=null,o=this;t=setInterval(function(){o.pointGridState&&o.isoLinesState&&(clearInterval(t),r&&r(o,e))},10)},remove:function(){for(var r in this)delete this[r];return this}},J.merge=function(r,e,t){var o=I(r)?r:[],n=Object.assign({},{width:800,height:600,child:[]},e);if(!t||!o.length||!n.child.length)return!1;var i=n.child,a=0,s=n.width,u=n.height,l=document.createElement("canvas");l.width=s,l.height=u;var f=l.getContext("2d");f.clearRect(0,0,s,u);for(var c=0,h=i.length;c<h;c++){var p=i[c],g=o[p.target];g&&(a++,g[p.type]&&g.initReady(function(r,e){var o=r[e.type](e.config,1),n=e.scale||1;a--;var i=f.createPattern(o,"no-repeat");if(f.fillStyle=i,f.save(),f.translate(e.x,e.y),f.scale(n,n),f.fillRect(0,0,o.width,o.height),f.restore(),!a)return t(l)},p))}},J});
