!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(r=r||self).IsoImage=e()}(this,function(){"use strict";Object.assign||(Object.assign=function(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var o,n=Object(r),i=Object.prototype.hasOwnProperty,a=0,s=e.length;a<s;a++)for(var u in o=Object(e[a]))i.call(o,u)&&(n[u]=o[u]);return n});var r=Math.max,e=Math.min,t=Math.abs,o=Math.floor;function n(r){return r=Number(r),isNaN(r)?0:0===r||r===1/0||r===-1/0?r:(r<0?-1:1)*o(t(r))}Array.prototype.max=function(){return Math.max.apply(null,this)},Array.prototype.min=function(){return Math.min.apply(null,this)},Array.prototype.mean=function(){var r,e;for(r=0,e=0;r<this.length;r++)e+=this[r];return e/this.length},Array.prototype.fill=function(t){var o=arguments[1],i=arguments[2],a=function(r){if(null==r)throw TypeError();return Object(r)}(this),s=function(r){var t=n(r);return t<=0?0:t===1/0?9007199254740991:e(t,9007199254740991)}(a.length);s=r(s,0);var u,l,f,c=n(o);for(u=c<0?r(s+c,0):e(c,s),f=(l=void 0===i?s:n(i))<0?r(s+l,0):e(l,s);u<f;){a[String(u)]=t,u+=1}return a},Array.prototype.rep=function(r){return Array.apply(null,new Array(r)).map(Number.prototype.valueOf,this[0])},Array.prototype.pip=function(r,e){var t,o,n=!1;for(t=0,o=this.length-1;t<this.length;o=t++)this[t][1]>e!=this[o][1]>e&&r<(this[o][0]-this[t][0])*(e-this[t][1])/(this[o][1]-this[t][1])+this[t][0]&&(n=!n);return n},function(r){var e={};function t(o){if(e[o])return e[o].exports;var n=e[o]={exports:{},id:o,loaded:!1};return r[o].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}t.m=r,t.c=e,t.p="",t(0)}([function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=i(t(10)),n=i(t(5));function i(r){return r&&r.__esModule?r:{default:r}}window.turfPointGrid=o.default,window.turfIsolines=n.default,e.default=o.default},,,,,function(r,e,t){var o,n=(o=t(6))&&"object"==typeof o&&"default"in o?o.default:o,i=t(7),a=t(9),s=t(8),u={successCallback:null,verbose:!1},l={};function f(r,e,t){t=t||{};for(var o=Object.keys(u),n=0;n<o.length;n++){var i=o[n],a=t[i];a=null!=a?a:u[i],l[i]=a}l.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+e);var s=function(r){var e=[],t=0;r.rows,r.cols;return r.cells.forEach(function(o,n){o.forEach(function(o,i){if(void 0!==o&&5!==(d=o).cval&&10!==d.cval&&!h(o)){var a=function(r,e,t){var o,n,i,a=r.length,s=[],u=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],l=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],f=["none","bottom","right","right","top","top","top","top","left","bottom","right","right","left","bottom","left","none"],c=(r[e][t],r[e][t]),h=c.cval,d=p(c,i=["none","left","bottom","left","right","none","bottom","left","top","top","none","top","right","right","bottom","none"][h]);s.push([t+d[0],e+d[1]]),d=p(c,i=f[h]),s.push([t+d[0],e+d[1]]),g(c);for(var v=t+u[h],y=e+l[h],w=h;v>=0&&y>=0&&y<a&&(v!=t||y!=e)&&void 0!==(c=r[y][v]);){if(0===(h=c.cval)||15===h)return{path:s,info:"mergeable"};i=f[h],o=u[h],n=l[h],5!==h&&10!==h||(5===h?c.flipped?-1===l[w]?(i="left",o=-1,n=0):(i="right",o=1,n=0):-1===u[w]&&(i="bottom",o=0,n=-1):10===h&&(c.flipped?-1===u[w]?(i="top",o=0,n=1):(i="bottom",o=0,n=-1):1===l[w]&&(i="left",o=-1,n=0))),d=p(c,i),s.push([v+d[0],y+d[1]]),g(c),v+=o,y+=n,w=h}return{path:s,info:"closed"}}(r.cells,n,i),s=!1;if("mergeable"===a.info)for(var u=a.path[a.path.length-1][0],l=a.path[a.path.length-1][1],f=t-1;f>=0;f--)if(Math.abs(e[f][0][0]-u)<=1e-7&&Math.abs(e[f][0][1]-l)<=1e-7){for(var c=a.path.length-2;c>=0;--c)e[f].unshift(a.path[c]);s=!0;break}s||(e[t++]=a.path)}var d})}),e}(function(r,e){for(var t=r.length-1,o=r[0].length-1,n={rows:t,cols:o,cells:[]},i=0;i<t;++i){n.cells[i]=[];for(var a=0;a<o;++a){var s=0,u=r[i+1][a],l=r[i+1][a+1],f=r[i][a+1],h=r[i][a];if(!(isNaN(u)||isNaN(l)||isNaN(f)||isNaN(h))){s|=u>=e?8:0,s|=l>=e?4:0,s|=f>=e?2:0;var g,p,d,v,y=!1;if(5===(s|=h>=e?1:0)||10===s){var w=(u+l+f+h)/4;5===s&&w<e?(s=10,y=!0):10===s&&w<e&&(s=5,y=!0)}if(0!==s&&15!==s)g=p=d=v=.5,1===s?(d=1-c(e,u,h),p=1-c(e,f,h)):2===s?(p=c(e,h,f),v=1-c(e,l,f)):3===s?(d=1-c(e,u,h),v=1-c(e,l,f)):4===s?(g=c(e,u,l),v=c(e,f,l)):5===s?(g=c(e,u,l),v=c(e,f,l),p=1-c(e,f,h),d=1-c(e,u,h)):6===s?(p=c(e,h,f),g=c(e,u,l)):7===s?(d=1-c(e,u,h),g=c(e,u,l)):8===s?(d=c(e,h,u),g=1-c(e,l,u)):9===s?(p=1-c(e,f,h),g=1-c(e,l,u)):10===s?(g=1-c(e,l,u),v=1-c(e,l,f),p=c(e,h,f),d=c(e,h,u)):11===s?(g=1-c(e,l,u),v=1-c(e,l,f)):12===s?(d=c(e,h,u),v=c(e,f,l)):13===s?(p=1-c(e,f,h),v=c(e,f,l)):14===s?(d=c(e,h,u),p=c(e,h,f)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+s),n.cells[i][a]={cval:s,flipped:y,top:g,right:v,bottom:p,left:d}}}}return n}(r,e));return"function"==typeof l.successCallback&&l.successCallback(s),s}function c(r,e,t){return(r-e)/(t-e)}function h(r){return 0===r.cval||15===r.cval}function g(r){h(r)||5===r.cval||10===r.cval||(r.cval=15)}function p(r,e){return"top"===e?[r.top,1]:"bottom"===e?[r.bottom,0]:"right"===e?[1,r.right]:"left"===e?[0,r.left]:void 0}function d(r,e){if(e=e||{},!s.isObject(e))throw new Error("options is invalid");var t=e.zProperty||"elevation",o=e.flip,n=e.flags;a.collectionOf(r,"Point","input must contain Points");for(var u=function(r,e){var t={};return i.featureEach(r,function(r){var e=a.getCoords(r)[1];t[e]||(t[e]=[]),t[e].push(r)}),Object.keys(t).map(function(r){return t[r].sort(function(r,e){return a.getCoords(r)[0]-a.getCoords(e)[0]})}).sort(function(r,t){return e?a.getCoords(r[0])[1]-a.getCoords(t[0])[1]:a.getCoords(t[0])[1]-a.getCoords(r[0])[1]})}(r,o),l=[],f=0;f<u.length;f++){for(var c=u[f],h=[],g=0;g<c.length;g++){var p=c[g];p.properties[t]?h.push(p.properties[t]):h.push(0),!0===n&&(p.properties.matrixPosition=[f,g])}l.push(h)}return l}function v(r,e,t){if(t=t||{},!s.isObject(t))throw new Error("options is invalid");var o=t.zProperty||"elevation",u=t.commonProperties||{},l=t.breaksProperties||[];if(a.collectionOf(r,"Point","Input must contain Points"),!e)throw new Error("breaks is required");if(!Array.isArray(e))throw new Error("breaks must be an Array");if(!s.isObject(u))throw new Error("commonProperties must be an Object");if(!Array.isArray(l))throw new Error("breaksProperties must be an Array");var c=d(r,{zProperty:o,flip:!0}),h=function(r,e,t){var o=n(t),a=o[2]-o[0],s=o[3]-o[1],u=o[0],l=o[1],f=e[0].length-1,c=e.length-1,h=a/f,g=s/c,p=function(r){r[0]=r[0]*h+u,r[1]=r[1]*g+l};return r.forEach(function(r){i.coordEach(r,p)}),r}(function(r,e,t,o,n){for(var i=[],a=1;a<e.length;a++){var u=+e[a],l=Object.assign({},o,n[a]);l[t]=u;var c=s.multiLineString(f(r,u),l);i.push(c)}return i}(c,e,o,u,l),c,r);return s.featureCollection(h)}r.exports=v,r.exports.default=v},function(r,e,t){var o=t(7);function n(r){var e=[1/0,1/0,-1/0,-1/0];return o.coordEach(r,function(r){e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])}),e}r.exports=n,r.exports.default=n},function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(8);function n(r,e,t){if(null!==r)for(var o,i,a,s,u,l,f,c,h=0,g=0,p=r.type,d="FeatureCollection"===p,v="Feature"===p,y=d?r.features.length:1,w=0;w<y;w++){u=(c=!!(f=d?r.features[w].geometry:v?r.geometry:r)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var m=0;m<u;m++){var b=0,E=0;if(null!==(s=c?f.geometries[m]:f)){l=s.coordinates;var M=s.type;switch(h=!t||"Polygon"!==M&&"MultiPolygon"!==M?0:1,M){case null:break;case"Point":if(!1===e(l,g,w,b,E))return!1;g++,b++;break;case"LineString":case"MultiPoint":for(o=0;o<l.length;o++){if(!1===e(l[o],g,w,b,E))return!1;g++,"MultiPoint"===M&&b++}"LineString"===M&&b++;break;case"Polygon":case"MultiLineString":for(o=0;o<l.length;o++){for(i=0;i<l[o].length-h;i++){if(!1===e(l[o][i],g,w,b,E))return!1;g++}"MultiLineString"===M&&b++,"Polygon"===M&&E++}"Polygon"===M&&b++;break;case"MultiPolygon":for(o=0;o<l.length;o++){for("MultiPolygon"===M&&(E=0),i=0;i<l[o].length;i++){for(a=0;a<l[o][i].length-h;a++){if(!1===e(l[o][i][a],g,w,b,E))return!1;g++}E++}b++}break;case"GeometryCollection":for(o=0;o<s.geometries.length;o++)if(!1===n(s.geometries[o],e,t))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&!1!==e(r.features[t].properties,t);t++);break;case"Feature":e(r.properties,0)}}function a(r,e){if("Feature"===r.type)e(r,0);else if("FeatureCollection"===r.type)for(var t=0;t<r.features.length&&!1!==e(r.features[t],t);t++);}function s(r,e){var t,o,n,i,a,s,u,l,f,c,h=0,g="FeatureCollection"===r.type,p="Feature"===r.type,d=g?r.features.length:1;for(t=0;t<d;t++){for(s=g?r.features[t].geometry:p?r.geometry:r,l=g?r.features[t].properties:p?r.properties:{},f=g?r.features[t].bbox:p?r.bbox:void 0,c=g?r.features[t].id:p?r.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,n=0;n<a;n++)if(null!==(i=u?s.geometries[n]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(i,h,l,f,c))return!1;break;case"GeometryCollection":for(o=0;o<i.geometries.length;o++)if(!1===e(i.geometries[o],h,l,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,h,l,f,c))return!1;h++}}function u(r,e){s(r,function(r,t,n,i,a){var s,u=null===r?null:r.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(o.feature(r,n,{bbox:i,id:a}),t,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<r.coordinates.length;l++){var f={type:s,coordinates:r.coordinates[l]};if(!1===e(o.feature(f,n),t,l))return!1}})}function l(r,e){u(r,function(r,t,i){var a=0;if(r.geometry){var s,u=r.geometry.type;if("Point"!==u&&"MultiPoint"!==u)return!1!==n(r,function(n,u,l,f,c){if(void 0!==s){var h=o.lineString([s,n],r.properties);if(!1===e(h,t,i,c,a))return!1;a++,s=n}else s=n})&&void 0}})}function f(r,e){if(!r)throw new Error("geojson is required");u(r,function(r,t,n){if(null!==r.geometry){var i=r.geometry.type,a=r.geometry.coordinates;switch(i){case"LineString":if(!1===e(r,t,n,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===e(o.lineString(a[s],r.properties),t,n,s))return!1}}})}e.coordEach=n,e.coordReduce=function(r,e,t,o){var i=t;return n(r,function(r,o,n,a,s){i=0===o&&void 0===t?r:e(i,r,o,n,a,s)},o),i},e.propEach=i,e.propReduce=function(r,e,t){var o=t;return i(r,function(r,n){o=0===n&&void 0===t?r:e(o,r,n)}),o},e.featureEach=a,e.featureReduce=function(r,e,t){var o=t;return a(r,function(r,n){o=0===n&&void 0===t?r:e(o,r,n)}),o},e.coordAll=function(r){var e=[];return n(r,function(r){e.push(r)}),e},e.geomEach=s,e.geomReduce=function(r,e,t){var o=t;return s(r,function(r,n,i,a,s){o=0===n&&void 0===t?r:e(o,r,n,i,a,s)}),o},e.flattenEach=u,e.flattenReduce=function(r,e,t){var o=t;return u(r,function(r,n,i){o=0===n&&0===i&&void 0===t?r:e(o,r,n,i)}),o},e.segmentEach=l,e.segmentReduce=function(r,e,t){var o=t,n=!1;return l(r,function(r,i,a,s,u){o=!1===n&&void 0===t?r:e(o,r,i,a,s,u),n=!0}),o},e.lineEach=f,e.lineReduce=function(r,e,t){var o=t;return f(r,function(r,n,i,a){o=0===n&&void 0===t?r:e(o,r,n,i,a)}),o},e.findSegment=function(r,e){if(e=e||{},!o.isObject(e))throw new Error("options is invalid");var t,n=e.featureIndex||0,i=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.segmentIndex||0,u=e.properties;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),u=u||r.features[n].properties,t=r.features[n].geometry;break;case"Feature":u=u||r.properties,t=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":t=r;break;default:throw new Error("geojson is invalid")}if(null===t)return null;var l=t.coordinates;switch(t.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),o.lineString([l[s],l[s+1]],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s-1),o.lineString([l[a][s],l[a][s+1]],u,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s-1),o.lineString([l[i][s],l[i][s+1]],u,e);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s-1),o.lineString([l[i][a][s],l[i][a][s+1]],u,e)}throw new Error("geojson is invalid")},e.findPoint=function(r,e){if(e=e||{},!o.isObject(e))throw new Error("options is invalid");var t,n=e.featureIndex||0,i=e.multiFeatureIndex||0,a=e.geometryIndex||0,s=e.coordIndex||0,u=e.properties;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),u=u||r.features[n].properties,t=r.features[n].geometry;break;case"Feature":u=u||r.properties,t=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":t=r;break;default:throw new Error("geojson is invalid")}if(null===t)return null;var l=t.coordinates;switch(t.type){case"Point":return o.point(l,u,e);case"MultiPoint":return i<0&&(i=l.length+i),o.point(l[i],u,e);case"LineString":return s<0&&(s=l.length+s),o.point(l[s],u,e);case"Polygon":return a<0&&(a=l.length+a),s<0&&(s=l[a].length+s),o.point(l[a][s],u,e);case"MultiLineString":return i<0&&(i=l.length+i),s<0&&(s=l[i].length+s),o.point(l[i][s],u,e);case"MultiPolygon":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),s<0&&(s=l[i][a].length-s),o.point(l[i][a][s],u,e)}throw new Error("geojson is invalid")}},function(r,e){Object.defineProperty(e,"__esModule",{value:!0});var t={meters:6371008.8,metres:6371008.8,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:6371008.8/1852,inches:6371008.8*39.37,yards:6371008.8/1.0936,feet:20902260.511392,radians:1,degrees:6371008.8/111325},o={meters:1,metres:1,millimeters:1e3,millimetres:1e3,centimeters:100,centimetres:100,kilometers:.001,kilometres:.001,miles:1/1609.344,nauticalmiles:1/1852,inches:39.37,yards:1/1.0936,feet:3.28084,radians:1/6371008.8,degrees:1/111325},n={meters:1,metres:1,millimeters:1e6,millimetres:1e6,centimeters:1e4,centimetres:1e4,kilometers:1e-6,kilometres:1e-6,acres:247105e-9,miles:3.86e-7,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function i(r,e,t){if(!y(t=t||{}))throw new Error("options is invalid");var o=t.bbox,n=t.id;if(void 0===r)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");o&&w(o),n&&m(n);var i={type:"Feature"};return n&&(i.id=n),o&&(i.bbox=o),i.properties=e||{},i.geometry=r,i}function a(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!v(r[0])||!v(r[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:r},e,t)}function s(r,e,t){if(!r)throw new Error("coordinates is required");for(var o=0;o<r.length;o++){var n=r[o];if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<n[n.length-1].length;a++){if(0===o&&0===a&&!v(n[0][0])||!v(n[0][1]))throw new Error("coordinates must contain numbers");if(n[n.length-1][a]!==n[0][a])throw new Error("First and last Position are not equivalent.")}}return i({type:"Polygon",coordinates:r},e,t)}function u(r,e,t){if(!r)throw new Error("coordinates is required");if(r.length<2)throw new Error("coordinates must be an array of two or more positions");if(!v(r[0][1])||!v(r[0][1]))throw new Error("coordinates must contain numbers");return i({type:"LineString",coordinates:r},e,t)}function l(r,e){if(!y(e=e||{}))throw new Error("options is invalid");var t=e.bbox,o=e.id;if(!r)throw new Error("No features passed");if(!Array.isArray(r))throw new Error("features must be an Array");t&&w(t),o&&m(o);var n={type:"FeatureCollection"};return o&&(n.id=o),t&&(n.bbox=t),n.features=r,n}function f(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiLineString",coordinates:r},e,t)}function c(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiPoint",coordinates:r},e,t)}function h(r,e,t){if(!r)throw new Error("coordinates is required");return i({type:"MultiPolygon",coordinates:r},e,t)}function g(r,e){if(null==r)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var o=t[e||"kilometers"];if(!o)throw new Error(e+" units is invalid");return r*o}function p(r,e){if(null==r)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var o=t[e||"kilometers"];if(!o)throw new Error(e+" units is invalid");return r/o}function d(r){if(null==r)throw new Error("radians is required");return 180*(r%(2*Math.PI))/Math.PI}function v(r){return!isNaN(r)&&null!==r&&!Array.isArray(r)}function y(r){return!!r&&r.constructor===Object}function w(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(4!==r.length&&6!==r.length)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(r){if(!v(r))throw new Error("bbox must only contain numbers")})}function m(r){if(!r)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof r))throw new Error("id must be a number or a string")}e.earthRadius=6371008.8,e.factors=t,e.unitsFactors=o,e.areaFactors=n,e.feature=i,e.geometry=function(r,e,t){if(!y(t=t||{}))throw new Error("options is invalid");var o,n=t.bbox;if(!r)throw new Error("type is required");if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");switch(n&&w(n),r){case"Point":o=a(e).geometry;break;case"LineString":o=u(e).geometry;break;case"Polygon":o=s(e).geometry;break;case"MultiPoint":o=c(e).geometry;break;case"MultiLineString":o=f(e).geometry;break;case"MultiPolygon":o=h(e).geometry;break;default:throw new Error(r+" is invalid")}return n&&(o.bbox=n),o},e.point=a,e.points=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return a(r,e)}),t)},e.polygon=s,e.polygons=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return s(r,e)}),t)},e.lineString=u,e.lineStrings=function(r,e,t){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");return l(r.map(function(r){return u(r,e)}),t)},e.featureCollection=l,e.multiLineString=f,e.multiPoint=c,e.multiPolygon=h,e.geometryCollection=function(r,e,t){if(!r)throw new Error("geometries is required");if(!Array.isArray(r))throw new Error("geometries must be an Array");return i({type:"GeometryCollection",geometries:r},e,t)},e.round=function(r,e){if(null==r||isNaN(r))throw new Error("num is required");if(e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t},e.radiansToLength=g,e.lengthToRadians=p,e.lengthToDegrees=function(r,e){return d(p(r,e))},e.bearingToAzimuth=function(r){if(null==r)throw new Error("bearing is required");var e=r%360;return e<0&&(e+=360),e},e.radiansToDegrees=d,e.degreesToRadians=function(r){if(null==r)throw new Error("degrees is required");return r%360*Math.PI/180},e.convertLength=function(r,e,t){if(null==r)throw new Error("length is required");if(!(r>=0))throw new Error("length must be a positive number");return g(p(r,e),t||"kilometers")},e.convertArea=function(r,e,t){if(null==r)throw new Error("area is required");if(!(r>=0))throw new Error("area must be a positive number");var o=n[e||"meters"];if(!o)throw new Error("invalid original units");var i=n[t||"kilometers"];if(!i)throw new Error("invalid final units");return r/o*i},e.isNumber=v,e.isObject=y,e.validateBBox=w,e.validateId=m,e.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},e.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},e.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},e.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},e.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},e.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},e.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}},function(r,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(8);e.getCoord=function(r){if(!r)throw new Error("coord is required");if("Feature"===r.type&&null!==r.geometry&&"Point"===r.geometry.type)return r.geometry.coordinates;if("Point"===r.type)return r.coordinates;if(Array.isArray(r)&&r.length>=2&&void 0===r[0].length&&void 0===r[1].length)return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(r){if(!r)throw new Error("coords is required");if("Feature"===r.type&&null!==r.geometry)return r.geometry.coordinates;if(r.coordinates)return r.coordinates;if(Array.isArray(r))return r;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function r(e){if(e.length>1&&o.isNumber(e[0])&&o.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return r(e[0]);throw new Error("coordinates must only contain numbers")},e.geojsonType=function(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)},e.featureOf=function(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||"Feature"!==r.type||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)},e.collectionOf=function(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||"FeatureCollection"!==r.type)throw new Error("Invalid input to "+t+", FeatureCollection required");for(var o=0;o<r.features.length;o++){var n=r.features[o];if(!n||"Feature"!==n.type||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}},e.getGeom=function(r){if(!r)throw new Error("geojson is required");if(void 0!==r.geometry)return r.geometry;if(r.coordinates||r.geometries)return r;throw new Error("geojson must be a valid Feature or Geometry Object")},e.getGeomType=function(){throw new Error("invariant.getGeomType has been deprecated in v5.0 in favor of invariant.getType")},e.getType=function(r,e){if(!r)throw new Error((e||"geojson")+" is required");if(r.geometry&&r.geometry.type)return r.geometry.type;if(r.type)return r.type;throw new Error((e||"geojson")+" is invalid")}},function(r,e,t){function o(r){return r&&"object"==typeof r&&"default"in r?r.default:r}var n=o(t(11)),i=o(t(14)),a=t(9),s=t(8);function u(r,e,t){if(t=t||{},!s.isObject(t))throw new Error("options is invalid");var o=t.mask,u=t.properties,l=[];if(null==e)throw new Error("cellSide is required");if(!s.isNumber(e))throw new Error("cellSide is invalid");if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be array");if(4!==r.length)throw new Error("bbox must contain 4 numbers");if(o&&-1===["Polygon","MultiPolygon"].indexOf(a.getType(o)))throw new Error("options.mask must be a (Multi)Polygon");for(var f=r[0],c=r[1],h=r[2],g=r[3],p=e/i([f,c],[h,c],t)*(h-f),d=e/i([f,c],[f,g],t)*(g-c),v=h-f,y=g-c,w=Math.floor(v/p),m=(y-Math.floor(y/d)*d)/2,b=f+(v-w*p)/2;b<=h;){for(var E=c+m;E<=g;){var M=s.point([b,E],u);o?n(M,o)&&l.push(M):l.push(M),E+=d}b+=p}return s.featureCollection(l)}r.exports=u,r.exports.default=u},function(r,e,t){function o(r){return r&&"object"==typeof r&&"default"in r?r.default:r}var n=o(t(6)),i=o(t(12)),a=o(t(13)),s=t(9);function u(r,e){var t=s.getType(r),o=s.getType(e),u=s.getGeom(r),c=s.getGeom(e);switch(t){case"Point":switch(o){case"MultiPoint":return function(r,e){var t,o=!1;for(t=0;t<e.coordinates.length;t++)if(f(e.coordinates[t],r.coordinates)){o=!0;break}return o}(u,c);case"LineString":return i(u,c,{ignoreEndVertices:!0});case"Polygon":return a(u,c,{ignoreBoundary:!0});default:throw new Error("feature2 "+o+" geometry not supported")}case"MultiPoint":switch(o){case"MultiPoint":return function(r,e){for(var t=0;t<r.coordinates.length;t++){for(var o=!1,n=0;n<e.coordinates.length;n++)f(r.coordinates[t],e.coordinates[n])&&(o=!0);if(!o)return!1}return!0}(u,c);case"LineString":return function(r,e){for(var t=!1,o=0;o<r.coordinates.length;o++){if(!i(r.coordinates[o],e))return!1;t||(t=i(r.coordinates[o],e,{ignoreEndVertices:!0}))}return t}(u,c);case"Polygon":return function(r,e){for(var t=!0,o=0;o<r.coordinates.length;o++){var n=a(r.coordinates[1],e);if(!n){t=!1;break}n=a(r.coordinates[1],e,{ignoreBoundary:!0})}return t&&n}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"LineString":return function(r,e){for(var t=0;t<r.coordinates.length;t++)if(!i(r.coordinates[t],e))return!1;return!0}(u,c);case"Polygon":return function(r,e){var t=n(e),o=n(r);if(!l(t,o))return!1;for(var i=!1,s=0;s<r.coordinates.length-1;s++){if(!a(r.coordinates[s],e))return!1;if(i||(i=a(r.coordinates[s],e,{ignoreBoundary:!0})),!i){var u=(f=r.coordinates[s],c=r.coordinates[s+1],[(f[0]+c[0])/2,(f[1]+c[1])/2]);i=a(u,e,{ignoreBoundary:!0})}}var f,c;return i}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Polygon":return function(r,e){var t=n(r);if(!l(n(e),t))return!1;for(var o=0;o<r.coordinates[0].length;o++)if(!a(r.coordinates[0][o],e))return!1;return!0}(u,c);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+t+" geometry not supported")}}function l(r,e){return!(r[0]>e[0])&&(!(r[2]<e[2])&&(!(r[1]>e[1])&&!(r[3]<e[3])))}function f(r,e){return r[0]===e[0]&&r[1]===e[1]}r.exports=u,r.exports.default=u},function(r,e,t){var o=t(9),n=t(8);function i(r,e,t){var i=(t=t||{}).ignoreEndVertices;if(!n.isObject(t))throw new Error("invalid options");if(!r)throw new Error("pt is required");if(!e)throw new Error("line is required");for(var s=o.getCoord(r),u=o.getCoords(e),l=0;l<u.length-1;l++){var f=!1;if(i&&(0===l&&(f="start"),l===u.length-2&&(f="end"),0===l&&l+1===u.length-1&&(f="both")),a(u[l],u[l+1],s,f))return!0}return!1}function a(r,e,t,o){var n=t[0],i=t[1],a=r[0],s=r[1],u=e[0],l=e[1],f=u-a,c=l-s;return 0==(t[0]-a)*c-(t[1]-s)*f&&(o?"start"===o?Math.abs(f)>=Math.abs(c)?f>0?a<n&&n<=u:u<=n&&n<a:c>0?s<i&&i<=l:l<=i&&i<s:"end"===o?Math.abs(f)>=Math.abs(c)?f>0?a<=n&&n<u:u<n&&n<=a:c>0?s<=i&&i<l:l<i&&i<=s:"both"===o?Math.abs(f)>=Math.abs(c)?f>0?a<n&&n<u:u<n&&n<a:c>0?s<i&&i<l:l<i&&i<s:void 0:Math.abs(f)>=Math.abs(c)?f>0?a<=n&&n<=u:u<=n&&n<=a:c>0?s<=i&&i<=l:l<=i&&i<=s)}r.exports=i,r.exports.default=i},function(r,e,t){var o=t(9);function n(r,e,t){if("object"!=typeof(t=t||{}))throw new Error("options is invalid");var n=t.ignoreBoundary;if(!r)throw new Error("point is required");if(!e)throw new Error("polygon is required");var a=o.getCoord(r),s=o.getCoords(e),u=e.geometry?e.geometry.type:e.type,l=e.bbox;if(l&&!1===function(r,e){return e[0]<=r[0]&&e[1]<=r[1]&&e[2]>=r[0]&&e[3]>=r[1]}(a,l))return!1;"Polygon"===u&&(s=[s]);for(var f=0,c=!1;f<s.length&&!c;f++)if(i(a,s[f][0],n)){for(var h=!1,g=1;g<s[f].length&&!h;)i(a,s[f][g],!n)&&(h=!0),g++;h||(c=!0)}return c}function i(r,e,t){var o=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var n=0,i=e.length-1;n<e.length;i=n++){var a=e[n][0],s=e[n][1],u=e[i][0],l=e[i][1];if(r[1]*(a-u)+s*(u-r[0])+l*(r[0]-a)==0&&(a-r[0])*(u-r[0])<=0&&(s-r[1])*(l-r[1])<=0)return!t;s>r[1]!=l>r[1]&&r[0]<(u-a)*(r[1]-s)/(l-s)+a&&(o=!o)}return o}r.exports=n,r.exports.default=n},function(r,e,t){var o=t(9),n=t(8);function i(r,e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var i=t.units,a=o.getCoord(r),s=o.getCoord(e),u=n.degreesToRadians(s[1]-a[1]),l=n.degreesToRadians(s[0]-a[0]),f=n.degreesToRadians(a[1]),c=n.degreesToRadians(s[1]),h=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(f)*Math.cos(c);return n.radiansToLength(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),i)}r.exports=i,r.exports.default=i}]);var i=function(){var r={},e=function(r,e){var t,o=new Array(e*e).fill(0);for(t=0;t<e;t++)o[t*e+t]=r;return o},t=function(r,e,t,o){var n,i,a=Array(t*o);for(n=0;n<t;n++)for(i=0;i<o;i++)a[n*o+i]=r[n*o+i]+e[n*o+i];return a},o=function(r,e,t,o,n){var i,a,s,u=Array(t*n);for(i=0;i<t;i++)for(a=0;a<n;a++)for(u[i*n+a]=0,s=0;s<o;s++)u[i*n+a]+=r[i*o+s]*e[s*n+a];return u},n=function(r,e){var t,o,n,i=Array(e);for(t=0;t<e;t++)i[t]=r[t*e+t];for(t=0;t<e;t++){for(o=0;o<t;o++)i[t]-=r[t*e+o]*r[t*e+o];if(i[t]<=0)return!1;for(i[t]=Math.sqrt(i[t]),o=t+1;o<e;o++){for(n=0;n<t;n++)r[o*e+t]-=r[o*e+n]*r[t*e+n];r[o*e+t]/=i[t]}}for(t=0;t<e;t++)r[t*e+t]=i[t];return!0},i=function(r,e){var t,o,n,i;for(t=0;t<e;t++)for(r[t*e+t]=1/r[t*e+t],o=t+1;o<e;o++){for(i=0,n=t;n<o;n++)i-=r[o*e+n]*r[n*e+t];r[o*e+t]=i/r[o*e+o]}for(t=0;t<e;t++)for(o=t+1;o<e;o++)r[t*e+o]=0;for(t=0;t<e;t++){for(r[t*e+t]*=r[t*e+t],n=t+1;n<e;n++)r[t*e+t]+=r[n*e+t]*r[n*e+t];for(o=t+1;o<e;o++)for(n=o;n<e;n++)r[t*e+o]+=r[n*e+t]*r[n*e+o]}for(t=0;t<e;t++)for(o=0;o<t;o++)r[t*e+o]=r[o*e+t]},a=function(r,e){var t,o,n,i,a,s,u,l,f,c,h,g=e,p=Array(e*e),d=Array(e),v=Array(e),y=Array(e);for(t=0;t<e;t++)for(i=0;i<e;i++)p[t*e+i]=t==i?1:0;for(i=0;i<e;i++)y[i]=0;for(t=0;t<e;t++){for(l=0,i=0;i<e;i++)if(1!=y[i])for(a=0;a<e;a++)0==y[a]&&Math.abs(r[i*e+a])>=l&&(l=Math.abs(r[i*e+a]),n=i,o=a);if(++y[o],n!=o){for(s=0;s<e;s++)h=r[n*e+s],r[n*e+s]=r[o*e+s],r[o*e+s]=h;for(s=0;s<g;s++)h=p[n*e+s],p[n*e+s]=p[o*e+s],p[o*e+s]=h}if(v[t]=n,d[t]=o,0==r[o*e+o])return!1;for(c=1/r[o*e+o],r[o*e+o]=1,s=0;s<e;s++)r[o*e+s]*=c;for(s=0;s<g;s++)p[o*e+s]*=c;for(u=0;u<e;u++)if(u!=o){for(f=r[u*e+o],r[u*e+o]=0,s=0;s<e;s++)r[u*e+s]-=r[o*e+s]*f;for(s=0;s<g;s++)p[u*e+s]-=p[o*e+s]*f}}for(s=e-1;s>=0;s--)if(v[s]!=d[s])for(a=0;a<e;a++)h=r[a*e+v[s]],r[a*e+v[s]]=r[a*e+d[s]],r[a*e+d[s]]=h;return!0},s=function(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*Math.pow(r/t,2)))},u=function(r,e,t,o,n){return e+(o-e)/t*(1-Math.exp(-1/n*(r/t)))},l=function(r,e,t,o,n){return r>t?e+(o-e)/t:e+(o-e)/t*(r/t*1.5-.5*Math.pow(r/t,3))};return r.train=function(r,f,c,h,g,p){var d={t:r,x:f,y:c,nugget:0,range:0,sill:0,A:1/3,n:0};switch(h){case"gaussian":d.model=s;break;case"exponential":d.model=u;break;case"spherical":d.model=l}var v,y,w,m,b=r.length,E=Array((b*b-b)/2);for(v=0,w=0;v<b;v++)for(y=0;y<v;y++,w++)E[w]=Array(2),E[w][0]=Math.pow(Math.pow(f[v]-f[y],2)+Math.pow(c[v]-c[y],2),.5),E[w][1]=Math.abs(r[v]-r[y]);E.sort(function(r,e){return r[0]-e[0]}),d.range=E[(b*b-b)/2-1][0];var M=(b*b-b)/2>30?30:(b*b-b)/2,P=d.range/M,x=new Array(M).fill(0),A=new Array(M).fill(0);if(M<30)for(m=0;m<M;m++)x[m]=E[m][0],A[m]=E[m][1];else{for(v=0,y=0,w=0,m=0;v<M&&y<(b*b-b)/2;v++,w=0){for(;E[y][0]<=(v+1)*P&&(x[m]+=E[y][0],A[m]+=E[y][1],w++,!(++y>=(b*b-b)/2)););w>0&&(x[m]/=w,A[m]/=w,m++)}if(m<2)return d}b=m,d.range=x[b-1]-x[0];var k=new Array(2*b).fill(1),S=Array(b),O=d.A;for(v=0;v<b;v++){switch(h){case"gaussian":k[2*v+1]=1-Math.exp(-1/O*Math.pow(x[v]/d.range,2));break;case"exponential":k[2*v+1]=1-Math.exp(-1/O*x[v]/d.range);break;case"spherical":k[2*v+1]=x[v]/d.range*1.5-.5*Math.pow(x[v]/d.range,3)}S[v]=A[v]}var j=function(r,e,t){var o,n,i=Array(t*e);for(o=0;o<e;o++)for(n=0;n<t;n++)i[n*e+o]=r[o*t+n];return i}(k,b,2),q=o(j,k,2,b,2),C=(q=t(q,e(1/p,2),2,2)).slice(0);n(q,2)?i(q,2):(a(C,2),q=C);var L=o(o(q,j,2,2,b),S,2,b,1);d.nugget=L[0],d.sill=L[1]*d.range+d.nugget,d.n=f.length,b=f.length;var T=Array(b*b);for(v=0;v<b;v++){for(y=0;y<v;y++)T[v*b+y]=d.model(Math.pow(Math.pow(f[v]-f[y],2)+Math.pow(c[v]-c[y],2),.5),d.nugget,d.range,d.sill,d.A),T[y*b+v]=T[v*b+y];T[v*b+v]=d.model(0,d.nugget,d.range,d.sill,d.A)}var I=t(T,e(g,b),b,b),N=I.slice(0);n(I,b)?i(I,b):(a(N,b),I=N);T=I.slice(0);var F=o(I,r,b,b,1);return d.K=T,d.M=F,d},r.predict=function(r,e,t){var n,i=Array(t.n);for(n=0;n<t.n;n++)i[n]=t.model(Math.pow(Math.pow(r-t.x[n],2)+Math.pow(e-t.y[n],2),.5),t.nugget,t.range,t.sill,t.A);return o(i,t.M,1,t.n,1)[0]},r}();const a=function(r,e){for(var t=r[0],o=r[1],n=!1,i=0,a=e.length-1;i<e.length;a=i++){var s=e[i][0],u=e[i][1],l=e[a][0],f=e[a][1];u>o!=f>o&&t<(l-s)*(o-u)/(f-u)+s&&(n=!n)}return n},s=function(r,e){return r[0]==e[0]&&r[1]==e[1]};var u=function(r,e,t,o,n,i,a){a=a||[];for(var l,f,c,h,g=o[o.length-1],p="t"==n||"b"==n?0:1,d="t"==n||"l"==n?1:-1,v=i?-1:1,y=0;t[n][y];y++){var w=t[n][y],m=(w.p[p]-g[p])*d*v;m>0&&(!l||l&&f>m)&&(l=w,f=m)}if(l)s(l.p,o[0])?o.push(l.p):(h=function(r){return JSON.parse(JSON.stringify(r))}(r[l.coor].coor),l.d&&h.reverse(),o=o.concat(h)),c=l.t;else if(i)switch(n){case"t":o.push(e.sa),c="l";break;case"r":o.push(e.sb),c="t";break;case"b":o.push(e.sc),c="r";break;case"l":o.push(e.sd),c="b"}else switch(n){case"t":o.push(e.sb),c="r";break;case"r":o.push(e.sc),c="b";break;case"b":o.push(e.sd),c="l";break;case"l":o.push(e.sa),c="t"}return o.length>1&&s(o[0],o[o.length-1])?[o].concat(a):(l&&h&&(a=u(r,e,t,h,c,!i,a)),o=u(r,e,t,o,c,i,a))};const l=function(r,e,t){for(var o=!1,n=0,i=r.length;n<i;n++){if(e<r[n].value){if(!o){o=JSON.parse(JSON.stringify(r[n]));break}var a=(e-o.value)/(r[n].value-o.value),s=function(e){return t?parseInt(o[e]+(r[n][e]-o[e])*a):r[n][e]};o.r=s("r"),o.g=s("g"),o.b=s("b");break}o=JSON.parse(JSON.stringify(r[n]))}return o},f=Math.abs,c=Math.max,h=Math.min,g=Math.floor,p=function(r,e){return f(r-e)},d=function(r,e){for(var t=0,o=c(p(e[0],e[2]),p(e[1],e[3])),n=0;n<4;n++){var i=p(e[n],r[n%2]);i<o&&(o=i,t=n)}return"lbrt".charAt(t)},v=function(r,e){return r[0]==e[0]&&r[1]==e[1]},y=function(r){return JSON.parse(JSON.stringify(r))};function w(r,e,t){var o=null==(t=t||{}).gradient||t.gradient,n=r.size,i=r.cellWidth,a=r.level,s=r.ex,u=t.width||1e3,f=Math.abs(u/n[0]*n[1]),c=document.createElement("canvas");c.width=u,c.height=f;var h=c.getContext("2d");h.clearRect(0,0,u,f);for(var g=e.features,p=Math.abs(i/n[0]*u),d=Math.abs(i/n[1]*f),v=0,y=g.length;v<y;v++){var w=g[v].geometry.coordinates,m=(w[0]-s[0][0])/n[0]*u-p/2,b=(w[1]-s[0][1])/n[1]*f-d/2,E=l(a,g[v].properties.val,o);h.strokeStyle=h.fillStyle="rgb("+E.r+","+E.g+","+E.b+")",h.beginPath(),h.fillRect(m-1,b-1,p+2,d+2)}return c}function m(r,e,t){t=t||{};var o=r.size,n=r.ex,i=t.width||1e3,a=Math.abs(i/o[0]*o[1]),s=t.isolineColor||"#333",u=document.createElement("canvas");u.width=i,u.height=a;var l=u.getContext("2d");l.clearRect(0,0,i,a),l.lineWidth=1,l.font="12px 微软雅黑",l.textBaseline="middle",l.textAlign="center";for(var f=e.features,c={},h=0,g=f.length;h<g;h++){var p=f[h].geometry.coordinates,d="level"==s?f[h].properties.color:s;l.strokeStyle=l.fillStyle=d;for(var v=0,y=p.length;v<y;v++){l.beginPath();for(var w=0,m=0,b=p[v].length;m<b;m++){var E=(p[v][m][0]-n[0][0])/o[0]*i,M=(p[v][m][1]-n[0][1])/o[1]*a;l[m?"lineTo":"moveTo"](E,M);var P=Math.round(E/16)+"-"+Math.round(M/16);c[P]||w||(c[P]=1,w=1,l.fillText(f[h].properties.val,E,M))}l.stroke()}}return u}const b=Object.prototype.toString,E=function(r){return"[object Array]"===b.call(r)};function M(r,e,t){if(!r[0])return!1;var o=(t=t||{}).opacity||1,n=r[0].width,i=r[0].height,a=document.createElement("canvas");a.width=n,a.height=i;var s=a.getContext("2d");s.clearRect(0,0,n,i),s.globalAlpha=o,s.strokeStyle=t.clipColor||"#333",s.lineWidth=t.clipWidth||1;var u=e.clip;if(u&&E(u)){var l=e.ex,f=e.size,c=e.key||{},h=c.clipX||0,g=c.clipY||1;s.beginPath();var p=function(r){if(E(r[0])&&E(r[0][0]))for(var e=0,t=r.length;e<t;e++)p(r[e]);else if(E(r))for(e=0,t=r.length;e<t;e++){var o=(r[e][h]-l[0][0])/f[0]*n,a=(r[e][g]-l[0][1])/f[1]*i;s[e?"lineTo":"moveTo"](o,a)}};p(u),t.clip&&s.stroke(),s.clip()}for(var d=0;r[d];d++){var v=s.createPattern(r[d],"repeat");s.fillStyle=v,s.fillRect(0,0,n,i)}return a}const P="IsoImage",x="image/png",A=Object.prototype.toString,k=Math.min,S=Math.max,O=Math.abs,j=Math.round,q={x:"x",y:"y",v:"v",clipX:"0",clipY:"1"};function C(r,e){this.name=P,this.initialize(r,e),this.getLegend=function(){return function(r){if(r.legend<2)return!1;var e=document.createElement("canvas");e.width=200,e.height=30;for(var t=e.getContext("2d"),o=t.createLinearGradient(0,0,200,0),n=0,i=r.length;n<i;n++){var a=r[n].color;o.addColorStop(1/i*n,a)}return t.fillStyle=o,t.fillRect(0,0,200,30),e.toDataURL("image/png")}(this.option.level||[])},this.getIsosurface=function(r){return!!this.alow()&&M([w(this.option,this.pointGrid,r)],this.option,r).toDataURL(x)},this.getIsoline=function(r){return!!this.alow()&&M([m(this.option,this.isoline,r)],this.option,r).toDataURL(x)},this.getIsoImage=function(r){return!!this.alow()&&M([w(this.option,this.pointGrid,r),m(this.option,this.isoline,r)],this.option,r).toDataURL(x)}}return C.prototype={constructor:C,initialize:function(r,e){var t=e.extent,o=e.level;if(!t)return console.log("缺少参数extent(画布左上右下坐标)");if(!o)return console.log("缺少参数level(色阶)");o=this.fmtLevel(o);var n=[k(t[0][0],t[1][0]),k(t[0][1],t[1][1]),S(t[0][0],t[1][0]),S(t[0][1],t[1][1])],i=[t[1][0]-t[0][0],t[1][1]-t[0][1]],a=e.cellWidth||j(O(i[0])/200*1e6)/1e6,s=Object.assign({},q,e.keyConfig);this.option={type:e.type||"idw",pow:e.pow||3,model:e.model||"spherical",clip:e.clip,smooth:e.smooth,ex:t,extent:n,size:i,cellWidth:a,level:o,key:s};var u=[],l=[],f=[],c=[];if(function(r){return"[object Array]"===A.call(r)}(r))for(var h=0,g=r.length;h<g;h++)if(null!=r[h][s.v]){var p=r[h][s.v],d=r[h][s.x],v=r[h][s.y];u.push({x:d,y:v,v:p}),l.push(p),f.push(d),c.push(v)}this.points=u,this._v=l,this._x=f,this._y=c,this.pointGrid=window.turfPointGrid(n,a,{units:"degrees"}),this.build()},build:function(){this.calcGridValue(),this.calcIsoLines()},calcGridValue:function(){var r=this.option,e=this.pointGrid;switch(r.type){case"kriging":for(var t=i.train(this._v,this._x,this._y,r.model,.1,100),o=0;o<e.features.length;o++){var n=i.predict(e.features[o].geometry.coordinates[0],e.features[o].geometry.coordinates[1],t);e.features[o].properties.val=n}break;default:var a=this.points;this.pointGrid=function(r,e,t){null==t&&(t=3);var o=e.features;if(r.length<3)return e;for(var n=r.length,i=o.length,a=[],s=0;s<i;s++)for(var u=0;u<n;u++){var l=Math.sqrt(Math.pow(o[s].geometry.coordinates[0]-r[u].x,2)+Math.pow(o[s].geometry.coordinates[1]-r[u].y,2));a.push(l)}for(s=0;s<i;s++){var f=!1;for(u=n*s;u<n*s+n;u++)if(Math.abs(a[u])<1e-4){o[s].properties.val=r[u-n*s].v,f=!0;break}if(!f){var c=0,h=0;for(u=n*s;u<n*s+n;u++)c+=r[u-n*s].v/Math.pow(a[u],t),h+=1/Math.pow(a[u],t);o[s].properties.val=c/h}}return e}(a,e,r.pow)}},calcIsoLines:function(){for(var r=this.option,e=this.pointGrid,t=r.level,o=[],n=0,i=t.length;n<i;n++)o.push(t[n].value);var s=window.turfIsolines(e,o,{zProperty:"val"}),p=s.features;for(n=0,i=p.length;n<i;n++)for(var w=p[n].properties.val,m=0;t[m];m++)if(t[m].value==w){p[n].properties.color=t[m].color;break}this.isoline=s,this.isosurface=function(r,e,t,o){for(var n,i=[],s=[],p={t:[],b:[],l:[],r:[]},w=r.features,m=0,b=w.length;m<b;m++)for(var E=w[m],M=0,P=(X=E.geometry.coordinates).length;M<P;M++){var x=X[M],A=x[0],k=x[x.length-1];if(v(A,k))i.push({coor:x,properties:E.properties,child:[],parent:[],i:i.length});else{s.push({coor:x,properties:E.properties});var S=d(A,e),O=d(k,e);p[S].push({p:A,end:k,d:0,t:O,coor:s.length-1}),p[O].push({p:k,end:A,d:1,t:S,coor:s.length-1})}}for(var j={sa:[e[0],e[3]],sb:[e[2],e[3]],sc:[e[2],e[1]],sd:[e[0],e[1]]},q=(m=0,(n=u(s,j,p,[j.sa],"t",!1)).length);m<q;m++)i.push({coor:n[m],properties:{type:"open"},child:[],parent:[],i:i.length});for(m=0,b=i.length;m<b;m++)for(var C=m+1;C<b;C++){var L=i[m].properties.type,T=i[C].properties.type;"open"!=L&&a(i[m].coor[0],i[C].coor)?(i[C].child.push(m),i[m].parent.push(C)):"open"!=T&&a(i[C].coor[0],i[m].coor)&&(i[m].child.push(C),i[C].parent.push(m))}var I=y(i),N=[],F=[],G=[],R=function(){if(I.length){for(var r=[],e=0,t=I.length;e<t;e++){for(var o=I[e],n=o.child,i=1,a=n.length-1;a>-1;a--)-1==F.indexOf(n[a])&&(i=0);if(i){var s=[];for(a=n.length-1;a>-1;a--){var u=G.indexOf(n[a]);u>-1&&(s.push(n[a]),G.splice(u,1))}G.push(o.i),F.push(o.i),I[e].child=s,N.push(I[e])}else r.push(I[e])}r.length&&(I=r,R())}};R();var _=[],z=t.features,J=z.length,D=z[0].geometry.coordinates,B=1,U=1,W=1;for(m=0;m<J;m++){var V=z[m].geometry.coordinates;if(1==m&&(W=f(V[1]-D[1])),V[0]!=D[0]){B=m,U=f(V[0]-D[0]);break}}for(m=0,b=N.length;m<b;m++){for(var X,Y=[(X=N[m]).coor],K="rgba(0, 0, 0, 0)",H=(C=0,X.child.length);C<H;C++)Y.push(i[X.child[C]].coor);var Q,Z=g(X.coor.length/2),$=X.coor[Z],rr=($[0]-D[0])/U,er=c(g(rr)*B+g(($[1]-D[1])/W),0),tr=rr%1?0:1,or=tr?1:B,nr=tr?W:U,ir=nr/100;if(z[er]&&z[er+or]){var ar=z[er].geometry.coordinates,sr=z[er+or].geometry.coordinates,ur=Object.assign([],$,[]);ur[tr]=c($[tr]-ir,ar[tr]);var lr=z[er].properties.val,fr=z[er+or].properties.val;a(ur,X.coor)?Q=lr+(fr-lr)*(f(ur[tr]-z[er].geometry.coordinates[tr])/nr):(ur[tr]=h($[tr]+2*ir,sr[tr]),a(ur,X.coor)&&(Q=lr+(fr-lr)*(f(ur[tr]-z[er].geometry.coordinates[tr])/nr)))}else z[er]&&(Q=z[er].properties.val);if(null!=Q){var cr=l(o,Q,!1);K="rgb("+cr.r+","+cr.g+","+cr.b+")"}_.push({geometry:{coordinates:Y,type:"MultiLineString"},properties:{color:K},type:"Feature"})}return{features:_,type:"FeatureCollection"}}(s,r.extent,e,t)},fmtLevel:function(r){for(var e=0,t=r.length;e<t;e++){var o=r[e].color;r[e].r=parseInt(o.substr(1,2),16),r[e].g=parseInt(o.substr(3,2),16),r[e].b=parseInt(o.substr(5,2),16)}return r},alow:function(){return this.pointGrid&&this.isoline}},C});
